"use strict";angular.module("services",[]),angular.module("myAdminApp",["loginAd","ngRoute","services","student","intern","message","partner","ngSanitize","notification","ui.router","ui.bootstrap","summernote","lecturers","angular-md5"]).config(["$locationProvider","$routeProvider","$stateProvider","$urlRouterProvider",function($locationProvider,$routeProvider,$stateProvider,$urlRouterProvider){$locationProvider.html5Mode(!1).hashPrefix(""),null==sessionStorage["Admin-Data"]?$routeProvider.when("/login",{templateUrl:"/modules/admin/views/loginAdmin/loginAdmin.html",controller:"LoginAdCtrl"}).otherwise({redirectTo:"/login"}):($urlRouterProvider.otherwise("/"),"ADMIN"==sessionStorage.role?$stateProvider.state("/",{url:"/",views:{notification:{templateUrl:"modules/admin/views/notification/notification.html",controller:"NotiCtrl"}}}).state("/user",{url:"/user",templateUrl:"modules/admin/views/user/user.all.html"}).state("/inbox",{url:"/inbox",templateUrl:"modules/admin/views/messages/inbox.html",controller:"messageCtrl"}).state("/sent",{url:"/sent",templateUrl:"modules/admin/views/messages/write.message.html",controller:"messageCtrl"}).state("/internship",{url:"/internship",templateUrl:"modules/admin/views/student/student.internship.html",controller:"studentCtrl"}).state("/lecturers",{url:"/lecturers",templateUrl:"modules/admin/views/vnu/lecturers.html",controller:"lecturersCtrl"}).state("/class",{url:"/class",templateUrl:"modules/admin/views/vnu/class.html",controller:"lecturersCtrl"}).state("/student",{url:"/student",templateUrl:"modules/admin/views/student/info_.html",controller:"studentCtrl"}).state("/registration-list",{url:"/registration-list",templateUrl:"modules/admin/views/student/follow.html",controller:"studentCtrl"}).state("/registration-partner",{url:"/registration-partner",templateUrl:"modules/admin/views/partner/partner.registration.html",controller:"partnerCtrl"}).state("/add-lecturers-student",{url:"/add-lecturers-student",templateUrl:"modules/admin/views/student/student.add.lecturers.html",controller:"studentCtrl"}).state("/post/page=:page",{url:"/post/page=:page",templateUrl:"modules/admin/views/partner/partner.all.post.html",controller:"partnerCtrl"}).state("/internship-term",{url:"/internship-term",templateUrl:"modules/admin/views/internship-term/internship-term.html",controller:"studentCtrl"}).state("/internship-term/:year/:term/:internshipTermId/post",{url:"/internship-term/:year/:term/:internshipTermId/post",templateUrl:"modules/admin/views/partner/partner.all.post.html",controller:"partnerCtrl"}).state("/internship-term/:year/:term/:internshipTermId/student",{url:"/internship-term/:year/:term/:internshipTermId/student",templateUrl:"modules/admin/views/student/student.internship.html",controller:"studentCtrl"}).state("/insertStudent",{url:"/insertStudent",templateUrl:"modules/admin/views/student/insert.student.html",controller:"studentCtrl"}).state("/student/edit",{url:"/student/edit",templateUrl:"modules/admin/views/student/info.edit.html",controller:"studentCtrl"}).state("/fit-partner",{url:"/fit-partner",templateUrl:"modules/admin/views/partner/partner.all.html",controller:"partnerCtrl"}).state("/other-partner",{url:"/other-partner",templateUrl:"modules/admin/views/partner/partner.all.html",controller:"partnerCtrl"}).state("/partner/:partnerId/intern",{url:"/partner/:partnerId/intern",templateUrl:"modules/admin/views/partner/partner.intern.html",controller:"studentCtrl"}).state("/partner/:partnerId",{url:"/partner/:partnerId",templateUrl:"modules/admin/views/partner/partner.html",controller:"partnerCtrl"}).state("/partner/:partnerId/post",{url:"/partner/:partnerId/post",templateUrl:"modules/admin/views/partner/partner.post.html",controller:"partnerCtrl"}).state("/post/:postId",{url:"/post/:postId",templateUrl:"modules/admin/views/partner/post.html",controller:"partnerCtrl"}):"LECTURERS"==sessionStorage.role&&$stateProvider.state("/",{url:"/",views:{notification:{templateUrl:"modules/admin/views/notification/notification.html",controller:"NotiCtrl"}}}).state("/inbox",{url:"/inbox",templateUrl:"modules/admin/views/messages/inbox.html",controller:"messageCtrl"}).state("/internship",{url:"/internship",templateUrl:"modules/admin/views/student/student.internship.html",controller:"studentCtrl"}))}]).filter("startFrom",function(){return function(input,start){return input?(start=+start,input.slice(start)):[]}}).directive("pressEnter",function(){return function(scope,element,attrs){element.bind("keydown keypress",function(event){13===event.which&&(scope.$apply(function(){scope.$eval(attrs.myEnter)}),event.preventDefault())})}}),angular.module("myAdminApp").controller("adminCtrl",["$scope","$rootScope","$location","$window","adminService","loginAdService",function($scope,$rootScope,$location,$window,adminService,loginAdService){$rootScope.serverAdd="http://localhost:8180",$rootScope.clientAdd="http://localhost:8000",$rootScope.index=!0,$rootScope.admin=!1,$scope.response=[],$scope.socket=[],$(document).ready(function(){$(".ui-pnotify").remove()}),$scope.getAllUser=function(stateParams){void 0!=stateParams&&($state.transitionTo("/user/page=:page",{page:1},{location:!0,notify:!1}),$stateParams.page=1),$stateParams.page&&($scope.activePage=$stateParams.page,adminService.getAllUser($stateParams.page-1,15).then(function(response){$scope.allPosts=response.data.content,$scope.pages=[];for(var page=response.data.totalPages,i=1;i<=page;i++)i==$stateParams.page?$scope.pages[i]={page:i,class:"active"}:$scope.pages[i]={page:i,class:""},$stateParams.page==page?$scope.nextPage={class:"disabled",page:page}:$scope.nextPage={class:"",page:parseInt($stateParams.page)+1},1==$stateParams.page?$scope.previousPage={class:"disabled",page:1}:$scope.previousPage={class:"",page:$stateParams.page-1};console.log(response.data)},function(error){console.log(error)}))},$scope.reconnect=function(){setTimeout($scope.initSockets,1e4)},$scope.initSockets=function(){$scope.socket.client=new SockJS($rootScope.serverAdd+"/uet"),$scope.socket.stomp=Stomp.over($scope.socket.client),$scope.socket.stomp.connect({},function(){$scope.socket.stomp.subscribe("/user/"+sessionStorage.username+"/**",function(message){if($scope.response=JSON.parse(message.body),console.log($rootScope.currentPageName),"/inbox"==$rootScope.currentPageName)console.log($rootScope.selectedMessage),void 0!=$rootScope.selectedMessage?$scope.response.parentId==$rootScope.selectedMessage.id?($rootScope.selectedMessage.messages.push($scope.response),$rootScope.selectedMessage.lastUpdated=$scope.response.sendDate,$rootScope.markMessageAsSeen($scope.response.parentId)):$scope.response.parentId!=$rootScope.selectedMessage.id&&(null!=$rootScope.selectedMessage.messages?$scope.response.parentId==$rootScope.selectedMessage.messages[0].id&&($rootScope.selectedMessage.messages.push($scope.response),$rootScope.selectedMessage.lastUpdated=$scope.response.sendDate,$rootScope.markMessageAsSeen($scope.response.parentId)):(console.log("31"),-1!=(index=$rootScope.messages.findIndex(x=>x.id===$scope.response.parentId))?(console.log("34"),$rootScope.messages[index].status="NEW","Normal"==$rootScope.messages[index].messageType&&($rootScope.messages[index].messages.push($scope.response),$rootScope.messages[index].lastUpdated=$scope.response.sendDate)):$rootScope.messages.push($scope.response))):-1!=(index=$rootScope.messages.findIndex(x=>x.id===$scope.response.parentId))?(console.log("34"),$rootScope.messages[index].status="NEW","Normal"==$rootScope.messages[index].messageType&&($rootScope.messages[index].messages.push($scope.response),$rootScope.messages[index].lastUpdated=$scope.response.sendDate)):$rootScope.messages.push($scope.response),$rootScope.$apply();else{var index=$rootScope.messages.findIndex(x=>x.id===$scope.response.parentId);-1!=index?(console.log("34"),$rootScope.messages[index].status="NEW","Normal"==$rootScope.messages[index].messageType&&($rootScope.messages[index].messages.push($scope.response),$rootScope.messages[index].lastUpdated=$scope.response.sendDate)):$rootScope.messages.push($scope.response),$rootScope.$apply()}})}),$scope.socket.client.onclose=$scope.reconnect},sessionStorage["Admin-Data"]?($rootScope.loggedIn=!0,$rootScope.role=sessionStorage.role,"LECTURERS"==$rootScope.role&&($location.path("/inbox"),$rootScope.lecturersId=sessionStorage.lecturersId,$scope.initSockets())):($rootScope.loggedIn=!1,$location.path("/admin/login")),console.log(sessionStorage.role),$scope.logout=function(){loginAdService.logout().then(function(){"LECTURERS"==$rootScope.role?(sessionStorage.clear(),$window.location.href=$rootScope.clientAdd+"/lecturers"):"ADMIN"==$rootScope.role&&(sessionStorage.clear(),$window.location.href=$rootScope.clientAdd+"/admin")},function(error){sessionStorage.clear(),$window.location.href=$rootScope.clientAdd+"/admin"})},$scope.getAllNotification=function(){adminService.getAllNotification().then(function(response){console.log(response),$rootScope.AllNotifications=response.data},function(error){console.log(error)})}}]),angular.module("intern",[]).controller("internCtrl",["$scope","internService","studentService","infoService","$rootScope","$stateParams","lecturersService","$window","$location","$timeout","filterFilter",function($scope,internService,studentService,infoService,$rootScope,$stateParams,lecturersService,$window,$location,$timeout,filterFilter){$rootScope.currentPageName=$state.current.name,$rootScope.index=!1,$scope.typing=!1,$scope.showIntern=!1,$scope.company=null,$scope.search=null,$scope.to_date=null,$scope.hideIntern=!1,$scope.comments=[],$scope.showInput=!1,$scope.input={},$scope.intern={},$scope.lecturers={},$scope.deleteIntern=function(internId){internService.deleteIntern(internId).then(function(response){$("#close_modal_delete_intern").trigger("click"),$scope.alertSuccess("Xóa internship thành công!",""),$scope.getAllStudentByInternshipTerm()},function(error){$("#close_modal_delete_intern").trigger("click"),$scope.alertDanger(error.data.message,"")})},$scope.createInternship=function(){"other"==$scope.intern.partnerId&&($scope.intern.partnerId=0),console.log($scope.intern),internService.createIntern($scope.intern).then(function(response){$scope.alertSuccess("Tạo internship thành công!",""),$scope.intern={},$scope.getAllStudentByInternshipTerm()},function(error){$scope.alertDanger(error.data.message,"")})},$scope.entry="",$scope.paginate=function(){""!=$scope.entry?($scope.entry>$scope.totalItems?$scope.entryLimit=$scope.totalItems:$scope.entryLimit=$scope.entry,$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit)):($scope.entryLimit=25,$scope.entryLimit>$scope.totalItems&&($scope.entryLimit=$scope.totalItems),$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit))},$scope.getAllStudentNoLecturers=function(){internService.getAllStudentNoLecturers().then(function(response){console.log(response.data),$scope.allStudentNoLecturers=response.data,$scope.totalItems=response.data.length,$scope.currentPage=1,$scope.entryLimit=25,$scope.entryLimit>$scope.totalItems&&($scope.entryLimit=$scope.totalItems),$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit),$scope.$watch("search",function(newVal,oldVal){$scope.filtered=filterFilter($scope.allStudentNoLecturers,newVal),$scope.totalItems=$scope.filtered.length,$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit),$scope.currentPage=1},!0)},function(error){console.log(error)})},$scope.getNameAndIdOfLecturers=function(){internService.getNameAndIdOfLecturers().then(function(response){console.log(response),$scope.nameAndIdOfLecturers=response.data},function(error){console.log(error)})},$scope.getNameAndIdOfPartnersFit=function(){alert(1),internService.getNameAndIdOfPartners("true").then(function(response){console.log(response),$scope.nameAndIdPartnersFit=response.data},function(error){console.log(error)})},$scope.getNameAndIdOfPartners=function(){internService.getNameAndIdOfPartners("false").then(function(response){console.log(response),$scope.nameAndIdPartners=response.data},function(error){console.log(error)})},$scope.getInternOfLecturers=function(){internService.getInternOfLecturers($rootScope.lecturersId).then(function(response){$scope.allInterns=response.data},function(error){console.log(error)})},$scope.addLecturersStudent=function(){internService.addLecturersStudent($scope.listStudent,$scope.lecturers.lecturersId).then(function(){$scope.alertSuccess("Thêm giảng viên thành công!",""),$scope.getAllStudentNoLecturers(),$scope.listStudent=[]},function(error){console.log(error),$scope.alertDanger(error.data.message,"")})},$scope.getAllLecturers=function(){lecturersService.getAllLecturers().then(function(response){$scope.allLecturers=response.data},function(error){console.log(error)})},$scope.listStudent=[],$scope.addStudent=function(student){if(1==student.checked)$scope.listStudent.push({id:student.id,studentName:student.fullName});else for(i=0;i<=$scope.listStudent.length;i++)if(student.id==$scope.listStudent[i].id){console.log(student.id),console.log($scope.listStudent[i]);var index=$scope.listStudent.indexOf($scope.listStudent[i]);$scope.listStudent.splice(index,1);break}},$scope.removeStudent=function(index){$scope.listStudent.splice(index,1)},$scope.createListStudentToAddLecturers=function(){$scope.listStudent=[],angular.forEach($scope.allInterns,function(intern){1==intern.checked&&$scope.listStudent.push({id:intern.id,studentName:intern.student.fullName})}),console.log($scope.listStudent)},$scope.getAllStudentByInternshipTerm=function(){internService.getAllStudentByInternshipTerm($stateParams.internshipTermId).then(function(response){$scope.allInterns=response.data,console.log(response)},function(error){console.log(error)})},$scope.getAllInternshipByInternshipTerm=function(){internService.getAllInternshipByInternshipTerm($stateParams.internshipTermId).then(function(response){$scope.allInterns=response.data,console.log(response)},function(error){console.log(error)})},$scope.loadAllInternshipTermPost=function(internshipTermId){internService.loadPostOfInternshipTerm(internshipTermId).then(function(response){$scope.allPosts=response.data},function(error){console.log(error)})},$scope.closePost=function(){$scope.show_post=!1},$scope.showPost=function(post){$scope.show_post=!0,$scope.post=post},$scope.alertDate=function(){console.log($scope.input.startDate)},$scope.createInternshipTerm=function(){""!=$scope.input.year&&""!=$scope.input.startDate&&""!=$scope.input.endDate&&(console.log($scope.input.startDate),internService.createInternshipTerm($scope.input).then(function(response){$scope.alertSuccess("Tạo kì thực tập thành công!",""),$scope.input.year="",$scope.input.endDate="",$scope.input.startDate="",$scope.getAllInternshipTerm()},function(error){$scope.alertDanger(error.message,"")}))},$scope.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],$scope.format=$scope.formats[0],$scope.altInputFormats=["M!/d!/yyyy"],$scope.dateOptions={formatYear:"yy",maxDate:new Date(2020,5,22),minDate:new Date,startingDay:1},$scope.open2=function(){$scope.popup2={},$scope.popup2.opened=!0},$scope.editInternshipTerm=function(startDate,endDate,internshipTermId){startDate=new Date,$("#internshipTerm_"+internshipTermId).val(startDate);var curr_date=startDate.getDate(),curr_month=startDate.getMonth()+1;startDate=startDate.getFullYear()+"-"+curr_month+"-"+curr_date},$scope.saveEditinternshipTerm=function(internshipTerm){internService.editInternshipTerm(internshipTerm).then(function(){$scope.alertSuccess("Sửa kì thực tập thành công!","")},function(error){$scope.alertDanger(error.data.message,"")})},$scope.getAllInternshipTerm=function(){internService.getAllInternshipTerm().then(function(response){console.log(response.data),$scope.allInternshipTerm=response.data},function(error){console.log(error)})},$scope.comfirmDelete=function(id){$scope.comfirmDeleteId=id},$scope.deleteInternshipTerm=function(id){internService.deleteInternshipTerm(id).then(function(){$("#close_modal_delete_internship_term").trigger("click"),$scope.alertSuccess("Xóa kì thực tập thành công!",""),$scope.getAllInternshipTerm()},function(error){$("#close_modal_delete_internship_term").trigger("click"),$scope.alertDanger("Không thể xóa kì thực tập này!","")})},$scope.showInput_=function(id,filterValue){$scope.showInput=!0,$("#"+id).after('<td><input  id="'+id+'_" type="text" value="'+filterValue+'"></td>'),$("#"+id).remove()},$scope.changeFilterValue=function(data){$scope.request={filter:data.filter},internService.changeFilterValue($scope.request,data.id).then(function(response){console.log(response)},function(error){alert("ko thanh cong"),console.log(error)})},$scope.saveManyFilterValue=function(){angular.forEach($scope.comments,function(comment){$scope.changeFilterValue(comment),comment.check=!1})},$scope.searchDate=function(data){},$scope.showComment=function(partnerid){0==$scope.hideIntern?($scope.hideIntern=!0,internService.showAllCommentOfOnePartner(partnerid).then(function(response){$scope.comments=response.data},function(error){console.log(error)})):$scope.hideIntern=!1},$scope.showAllInternOfPartner=function(){$scope.partnerId=$stateParams.partnerId,internService.showAllInternOfPartner($stateParams.partnerId).then(function(response){$scope.allInternOfPartner=response.data,$scope.count=$scope.allInternOfPartner.length,angular.forEach($scope.allInternOfPartner,function(intern){null==$scope.company&&($scope.company=intern.company),null==$scope.company&&($scope.company=intern.company),infoService.loadStudentInfo(intern.studentId).then(function(response){intern.studentInfo=response.data})})},function(error){console.log(error)})},$scope.showAllIntern_=function(){0==$scope.showIntern||1==$scope.saveIntern?($scope.showIntern=!0,$scope.saveIntern=!1,$scope.showIsIntern()):$scope.showIntern=!1},$scope.showNotIntern=function(){$scope.notIntern=[],studentService.loadAllStudent().then(function(data){$scope.allIntern=data.data,angular.forEach($scope.allIntern,function(v){null==v.internship&&$scope.notIntern.push(v)})})},$scope.showIsIntern=function(){$scope.isIntern=[],studentService.loadAllStudent().then(function(data){$scope.allIntern=data.data,angular.forEach($scope.allIntern,function(v){null!=v.internship&&(v.checked=!1,$scope.isIntern.push(v))})},function(){})},$scope.getPartner=function(){internService.getPartner().then(function(data){$scope.partner=data.data})},$scope.showPartner=function(){""==$scope.create.partnerName?$scope.partner=!1:($scope.getPartner(),$scope.partner=!0)},$scope.choosePartner=function(partner){$scope.create.partnerName=partner.partnerName,$scope.create.partnerId=partner.id,$scope.partner=!1},$scope.chooseStudent=function(student){$scope.create.infoBySchool.studentCode=student.infoBySchool.studentCode,$scope.create.studentId=student.id,$scope.typing=!1},$scope.creatIntern=function(){$scope.request={partnerId:$scope.create.partnerId,company:$scope.create.partnerName,startDate:$scope.create.startDate,endDate:$scope.create.endDate,supervisor:$scope.create.supervisor},internService.createIntern($scope.request,$scope.create.studentId).then(function(){$scope.saveIntern=!0,$scope.showAllIntern_(),$scope.create.partnerId="",$scope.create.partnerName="",$scope.create.startDate="",$scope.create.endDate="",$scope.create.supervisor=""},function(error){$scope.response=error}),$scope.create.infoBySchool.studentCode=null},$scope.showName=function(){""==$scope.create.infoBySchool.studentCode?$scope.typing=!1:($scope.typing=!0,$scope.showNotIntern())},$scope.count=0,$scope.chooseIntern=function(intern){1!=intern.checked?(intern.checked=!0,0==$scope.count?$scope.count=1:$scope.count++):1==intern.checked&&(intern.checked=!1,$scope.count--)},$scope.editIntern=function(intern){internService.editIntern(intern).then(function(){$scope.showIntern=!1,$scope.showAllIntern_()})},$scope.selectAllId=!1,$scope.selectAll=function(){0==$scope.selectAllId?($scope.count=0,angular.forEach($scope.isIntern,function(v){v.checked=!0,$scope.count++}),$scope.selectAllId=!0):(angular.forEach($scope.isIntern,function(v){v.checked=!1}),$scope.count=0,$scope.selectAllId=!1)},$scope.delOne=function(intern){internService.del(intern.internship.id,intern.id),$scope.count=0,$scope.showIntern=!1,$scope.showAllIntern_()},$scope.delAll=function(){angular.forEach($scope.isIntern,function(v){1==v.checked&&internService.del(v.internship.id,v.id)}),$scope.count=0,$scope.showIntern=!1,$scope.showAllIntern_()},$scope.comfirmDelete=function(id){console.log(id),$scope.comfirmDeleteId=id},$scope.alertWarning=function(warning,timeout){$scope.warningMessage=warning,$scope.warning=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.warning=!1,$scope.warningMessage=""})},timeout)},$scope.alertDanger=function(error,danger){$scope.errorMessage=error,"danger"==danger?($scope.danger_edit=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.danger_edit=!1})},6e3)):($scope.danger=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.danger=!1,$scope.errorMessage=""})},6e3))},$scope.alertSuccess=function(string,success){$scope.successMessage=string,"successdelete_edit"==success?($scope.successdelete_edit=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.successdelete_edit=!1})},3e3)):($scope.success=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.success=!1})},3e3))}}]),angular.module("lecturers",[]).controller("lecturersCtrl",["filterFilter","$scope","lecturersService","$location","$rootScope","$window","$timeout","md5","$state",function(filterFilter,$scope,lecturersService,$location,$rootScope,$window,$timeout,md5,$state){$rootScope.currentPageName=$state.current.name,$scope.entry="",$scope.input={},$scope.getAllStudentClass=function(){lecturersService.getAllStudentClass().then(function(response){console.log(response),$scope.allStudentClass=response.data},function(error){console.log(error)})},$scope.createStudentClass=function(){null!=$scope.input.studentClass&&lecturersService.createStudentClass($scope.input).then(function(){$scope.alertSuccess("Thêm lớp khóa học thành công!",""),$scope.getAllStudentClass(),$scope.input={}},function(error){$scope.alertDanger(error.data.message,"")})},$scope.deleteStudentClass=function(id){$("#close_modal_delete_delete_class").trigger("click"),lecturersService.deleteStudentClass(id).then(function(){$scope.alertSuccess("Xóa lớp khóa học thành công!",""),$scope.getAllStudentClass()},function(error){console.log(error),$scope.alertDanger(error.message.data,"")})},$scope.editStudentClass=function(studentClassId,classNameId){var studentClass=$("#studentClass_"+studentClassId).text();$("#studentClass_"+studentClassId).html('<input id="studentClass_value_'+studentClassId+'" value="'+studentClass+'" style="border-radius:3px; border: 1px solid; width: 50%;"/>');var className=$("#className_"+studentClassId).text();$("#className_"+studentClassId).html('<input id="className_value_'+studentClassId+'" value="'+className+'" style="border-radius:3px; border: 1px solid; width: 50%;"/>'),$("#edit_studentClass_"+studentClassId).hide(),$("#save_edit_studentClass_"+studentClassId).show()},$scope.saveEditStudentClass=function(studentClassId){var studentClass=$("#studentClass_value_"+studentClassId).val(),className=$("#className_value_"+studentClassId).val();$scope.request={id:studentClassId,studentClass:studentClass,className:className},console.log($scope.request),lecturersService.editStudentCLass($scope.request).then(function(){$("#save_edit_studentClass_"+studentClassId).hide(),$("#studentClass_"+studentClassId).html(studentClass),$("#edit_studentClass_"+studentClassId).show(),$("#className_"+studentClassId).html(className),$scope.alertSuccess("Sửa tên lớp thành công!","")},function(error){console.log(error),$scope.alertDanger(error.data.message,"")})},$scope.convert=function(){var xlf=document.getElementById("xlf");xlf.addEventListener&&xlf.addEventListener("change",function(e){var i,f,files=e.target.files;for(f=files[i=0];i!=files.length;++i){var reader=new FileReader;f.name,reader.onload=function(e){var data=e.target.result,workbook=XLSX.read(data,{type:"binary"}),first_sheet_name=workbook.SheetNames[0],worksheet=workbook.Sheets[first_sheet_name];worksheet.B1.w="fullName",worksheet.C1.w="subject",worksheet.D1.w="phoneNumber",worksheet.E1.w="emailvnu",$rootScope.excel=XLSX.utils.sheet_to_json(worksheet)},reader.readAsBinaryString(f)}},!1)},$scope.setExcelTable=function(){console.log($rootScope.excel),$scope.excelTable=$rootScope.excel,angular.forEach($scope.excelTable,function(lecturers){lecturers.userName=lecturers.emailvnu.replace(/(?:@vnu.edu.vn|@gmail.com)/g,"")})},$scope.send=function(){$scope.errorCount=0,lecturersService.createLecturersFromExcel($scope.excelTable).then(function(response){console.log(response),$scope.excelTable=null,angular.forEach(response.data,function(lecturers){if("userNameExisted"==lecturers.status)$("#"+lecturers.userName).css("background-color","#f0ad4e"),$scope.errorCount++,console.log(lecturers.userName);else{var index=response.data.indexOf(lecturers);response.data.splice(index,1)}}),0!=$scope.errorCount?($scope.alertDanger("Kiểm tra lại các giảng viên sau, UserName bị trùng",""),$scope.excelTable=response.data):($scope.alertSuccess("Nhập giảng viên thành công!",""),$scope.getAllLecturers())},function(error){console.log(error),$scope.alertDanger(error.data.message,"")})},$scope.paginate=function(){""!=$scope.entry?($scope.entry>$scope.totalItems?$scope.entryLimit=$scope.totalItems:$scope.entryLimit=$scope.entry,$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit)):($scope.entryLimit=25,$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit))},$scope.getAllLecturers=function(){lecturersService.getAllLecturers().then(function(response){console.log(response),$scope.allLecturers=response.data,$scope.totalItems=response.data.length,$scope.currentPage=1,$scope.entryLimit=25,$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit),$scope.$watch("search",function(newVal,oldVal){$scope.filtered=filterFilter($scope.allLecturers,newVal),$scope.totalItems=$scope.filtered.length,$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit),$scope.currentPage=1},!0)},function(error){console.log(error)})},$scope.getAllFaculty=function(){lecturersService.getAllFaculty().then(function(response){$scope.allFaculty=response.data},function(error){console.log(error)})},$scope.createFaculty=function(){lecturersService.createFaculty($scope.input).then(function(){$scope.getAllFaculty(),$scope.alertSuccess("Tạo thêm khoa thành công!","")},function(error){$scope.alertDanger(error.message,"")})},$scope.createLecturers=function(){$scope.lecturers.role="LECTURERS",$scope.lecturers.password=md5.createHash($scope.lecturers.password||""),console.log($scope.lecturers),lecturersService.createLecturers($scope.lecturers).then(function(response){$scope.alertSuccess("Thêm giảng viên thành công!",""),$scope.lecturers={},$scope.getAllLecturers()},function(error){console.log(error),$scope.alertDanger(error.data.message,"")})},$scope.confirmDelete=function(id,name){console.log(id),$scope.confirmDeleteId=id,$scope.confirmDeleteName=name},$scope.deleteLecturers=function(lecturersId){$("#close_modal_delete_lecturers").trigger("click"),lecturersService.deleteLecturers(lecturersId).then(function(){$scope.alertSuccess("Xóa giảng viên thành công",""),$scope.getAllLecturers()},function(error){$scope.alertDanger(error.data.message,"")})},$scope.editLecturers=function(lecturersId){var fullName=$("#fullName_"+lecturersId).text();$("#fullName_"+lecturersId).html('<input id="fullName_value_'+lecturersId+'" value="'+fullName+'" style="border-radius:3px; border: 1px solid;"/>');var email=$("#email_"+lecturersId).text();$("#email_"+lecturersId).html('<input id="email_value_'+lecturersId+'" value="'+email+'" style="border-radius:3px; border: 1px solid;"/>');var emailVNU=$("#emailVNU_"+lecturersId).text();$("#emailVNU_"+lecturersId).html('<input id="emailVNU_value_'+lecturersId+'" value="'+emailVNU+'" style="border-radius:3px; border: 1px solid;"/>');var subject=$("#subject_"+lecturersId).text();$("#subject_"+lecturersId).html('<input id="subject_value_'+lecturersId+'" value="'+subject+'" style="border-radius:3px; border: 1px solid; width: 70%;"/>');var phoneNumber=$("#phoneNumber_"+lecturersId).text();$("#phoneNumber_"+lecturersId).html('<input id="phoneNumber_value_'+lecturersId+'" value="'+phoneNumber+'" style="border-radius:3px; border: 1px solid; width: 70%;"/>'),$("#edit_lecturers_"+lecturersId).hide(),$("#save_edit_lecturers_"+lecturersId).show()},$scope.saveEditLecturers=function(lecturersId){var fullName=$("#fullName_value_"+lecturersId).val(),email=$("#email_value_"+lecturersId).val(),emailVNU=$("#emailVNU_value_"+lecturersId).val(),subject=$("#subject_value_"+lecturersId).val(),phoneNumber=$("#phoneNumber_value_"+lecturersId).val();$scope.request={id:lecturersId,fullName:fullName,email:email,emailVNU:emailVNU,subject:subject,phoneNumber:phoneNumber},lecturersService.editLecturers($scope.request).then(function(){$("#edit_lecturers_"+lecturersId).show(),$("#save_edit_lecturers_"+lecturersId).hide(),$("#fullName_"+lecturersId).html(fullName),$("#email_"+lecturersId).html(email),$("#emailVNU_"+lecturersId).html(emailVNU),$("#subject_"+lecturersId).html(subject),$("#phoneNumber_"+lecturersId).html(phoneNumber),$scope.alertSuccess("Sửa Giảng viên thành công!","")},function(error){console.log(error),$scope.alertDanger(error.data.message,"")})},$scope.alertDanger=function(error,danger){$scope.errorMessage=error,"danger"==danger?($scope.danger_edit=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.danger_edit=!1})},6e3)):($scope.danger=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.danger=!1,$scope.errorMessage=""})},6e3))},$scope.alertSuccess=function(string,success){$scope.successMessage=string,"successdelete_edit"==success?($scope.successdelete_edit=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.successdelete_edit=!1})},3e3)):($scope.success=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.success=!1})},3e3))}}]),function(){angular.module("loginAd",[]);angular.module("loginAd").controller("LoginAdCtrl",["$scope","loginAdService","$location","$rootScope","$window","md5",function($scope,loginAdService,$location,$rootScope,$window,md5){$rootScope.loggedIn=!1,$rootScope.admin=!0,$scope.loginAd=function(){$scope.request={userName:$scope.loginAd.username,password:md5.createHash($scope.loginAd.password||"")},loginAdService.loginAd($scope.request).then(function(response){console.log(response),null!=response.data.token&&(sessionStorage.setItem("Admin-Data",response.data.token),sessionStorage.setItem("username",response.data.userName),sessionStorage.setItem("idAdmin",response.data.id),sessionStorage.setItem("role",response.data.role),null!=response.data.lecturers&&sessionStorage.setItem("lecturersId",response.data.lecturers.id)),"ADMIN"==response.data.role?window.location.href=$rootScope.clientAdd+"/admin":"LECTURERS"==response.data.role&&(window.location.href=$rootScope.clientAdd+"/lecturers")},function(error){alert("dang nhap khong thanh cong")})}}])}(),function(){angular.module("message",[]);angular.module("message").controller("messageCtrl",["$timeout","$scope","$rootScope","$location","$window","messageService","$state","$sce",function($timeout,$scope,$rootScope,$location,$window,messageService,$state,$sce){$rootScope.currentPageName=$state.current.name,$scope.message={},$scope.reply={},$rootScope.initPage=1,$scope.deleteNotificationMessage=function(messageId){$("#close_modal_delete_message").trigger("click"),messageService.deleteNotificationMessage(messageId).then(function(){$scope.getNotificationMessage()},function(error){console.log(error)})},$scope.getNotificationMessage=function(){messageService.getNotificationMessage().then(function(response){$scope.notificationMessage=response.data},function(error){console.log(error)})},$scope.createNotification=function(){$scope.notification.content=$scope.notification.content.replace(/(?:\r\n|\r|\n)/g,"<br />"),messageService.createNotificationMessage($scope.notification).then(function(){$scope.getNotificationMessage(),$scope.notification.content=""},function(error){console.log(error)})},$scope.getAllMessage=function(page){if($scope.page=page,$rootScope.messages=[],console.log($rootScope.initPage),void 0==$rootScope.lastUpdated){currentTime=new Date;var curr_date=currentTime.getDate(),curr_month=currentTime.getMonth()+1,curr_year=currentTime.getFullYear(),curr_hours=currentTime.getHours(),curr_min=currentTime.getMinutes(),curr_sec=currentTime.getSeconds();currentTime=curr_year+"-"+curr_month+"-"+curr_date+" "+curr_hours+":"+curr_min+":"+curr_sec,$rootScope.lastUpdated=currentTime}messageService.getAllMessage($rootScope.initPage-1,20,$rootScope.lastUpdated).then(function(response){console.log(response),$rootScope.messagesCount=response.data.length,angular.forEach(response.data.content,function(v){$rootScope.messages.push(v)}),$rootScope.initPage++,$scope.pages=[];for(var page=response.data.totalPages,i=1;i<=page;i++)i==$scope.page?$scope.pages[i]={page:i,class:"active"}:$scope.pages[i]={page:i,class:""},$scope.page==page?$scope.nextPage={class:"disabled",page:page}:$scope.nextPage={class:"",page:parseInt($scope.page)+1},1==$scope.page?$scope.previousPage={class:"disabled",page:1}:$scope.previousPage={class:"",page:$scope.page-1}},function(error){console.log(error)})},$scope.getAllStudent=function(page){$scope.page=page,studentService.getAllStudent(page-1,10).then(function(response){console.log(response),$scope.allStudents=response.data.content,$scope.pages=[];for(var page=response.data.totalPages,i=1;i<=page;i++)i==$scope.page?$scope.pages[i]={page:i,class:"active"}:$scope.pages[i]={page:i,class:""},$scope.page==page?$scope.nextPage={class:"disabled",page:page}:$scope.nextPage={class:"",page:parseInt($scope.page)+1},1==$scope.page?$scope.previousPage={class:"disabled",page:1}:$scope.previousPage={class:"",page:$scope.page-1}})},$scope.showMessage=function(message){"Inbox"==message.messageType?($scope.receiverName=message.senderName,messageService.getOneMessage(message.id).then(function(response){console.log(response.data),$rootScope.selectedMessage=response.data},function(error){content.log(error)})):($scope.receiverName=message.senderName,$rootScope.selectedMessage=message),console.log($scope.receiverName),"NEW"==message.status&&messageService.markMessageAsSeen(message.id).then(function(){message.status=""})};angular.element(document.querySelector("#baocao")).on("change",function(evt){var file=evt.currentTarget.files[0];console.log(evt.currentTarget.files),$scope.message.fileName=evt.currentTarget.files[0].name,$scope.message.fileType=evt.currentTarget.files[0].name.split(".").pop();var reader=new FileReader;reader.onload=function(evt){$scope.$apply(function($scope){$scope.message.attachFile=evt.target.result.split(",").pop()})},reader.readAsDataURL(file)}),$rootScope.markMessageAsSeen=function(messageId){messageService.markMessageAsSeen(messageId).then(function(){})},$scope.getLinkFile=function(attachFileAdd){$rootScope.modalFileLink=$sce.trustAs($sce.RESOURCE_URL,"https://docs.google.com/gview?url="+$rootScope.clientAdd+attachFileAdd+"&embedded=true")},$scope.getFileName=function(fileAdd){return fileAdd.split("/").pop()},$scope.getLinkDownLoad=function(fileAdd){return $rootScope.clientAdd+fileAdd},$scope.sendMessage=function(){void 0!=$scope.message.content&&($scope.message.content=$scope.message.content.replace(/(?:\r\n|\r|\n)/g,"<br />"),console.log($scope.message),messageService.createMessage($scope.message).then(function(){$scope.message={},new PNotify({title:"Gửi tin nhắn thành công!",type:"success",styling:"bootstrap3"})},function(error){console.log(error),$scope.alertDanger("Error","")}))},$scope.replyMessage=function(){void 0!=$scope.reply.content&&($scope.reply.content=$scope.reply.content.replace(/(?:\r\n|\r|\n)/g,"<br />"),$scope.reply.receiverName=$scope.receiverName,$scope.reply.messageId=$rootScope.selectedMessage.id,messageService.createMessage($scope.reply).then(function(response){console.log(response.data),$scope.reply={},$rootScope.selectedMessage.messages.push(response.data),$rootScope.selectedMessage.lastUpdated=(new Date).getTime()},function(error){console.log(error),$scope.alertDanger(error.data.message,"")}))},$scope.confirmDelete=function(id){console.log(id),$scope.confirmDeleteId=id},$scope.alertWarning=function(warning,timeout){$scope.warningMessage=warning,$scope.warning=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.warning=!1,$scope.warningMessage=""})},timeout)},$scope.alertDanger=function(error,danger){$scope.errorMessage=error,"danger"==danger?($scope.danger_edit=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.danger_edit=!1})},6e3)):($scope.danger=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.danger=!1,$scope.errorMessage=""})},6e3))},$scope.alertSuccess=function(string,success){$scope.successMessage=string,"successdelete_edit"==success?($scope.successdelete_edit=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.successdelete_edit=!1})},3e3)):($scope.success=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.success=!1})},3e3))}}])}(),angular.module("notification",[]).controller("NotiCtrl",["$scope","notificationService","$location","$rootScope","$window",function($scope,notificationService,$location,$rootScope,$window){$scope.getAllNotification=function(){notificationService.getAllNotification().then(function(response){console.log(response),$rootScope.AllNotifications=response.data},function(error){console.log(error)})}}]),function(){angular.module("partner",[]);angular.module("partner").controller("partnerCtrl",["filterFilter","$window","$scope","partnerService","studentService","$location","$rootScope","$timeout","$stateParams","messageService","md5","$state",function(filterFilter,$window,$scope,partnerService,studentService,$location,$rootScope,$timeout,$stateParams,messageService,md5,$state){$rootScope.currentPageName=$state.current.name,$scope.loadPartner=!0,$scope.partnersRole=[{role:"VIP_PARTNER"},{role:"NORMAL_PARTNER"}],$scope.post={},$scope.role=$scope.partnersRole[0],$scope.editIma=!1,$scope.request={},$scope.editPostTimeModal={},$scope.search="",$scope.partner={},$scope.input={},$rootScope.currentPageName=$state.current.name,console.log($rootScope.currentPageName),$scope.acceptPartner=function(){$scope.listAcceptPartner=[],angular.forEach($scope.allWaitPartner,function(partner){1==partner.checked&&(partner.status=null,$scope.listAcceptPartner.push(partner))}),console.log($scope.listAcceptPartner),partnerService.acceptPartner($scope.listAcceptPartner).then(function(){$scope.alertSuccess("Thành Công!","")},function(error){console.log(error)})},$scope.notAcceptPartner=function(){$scope.listAcceptPartner=[],angular.forEach($scope.allWaitPartner,function(partner){1==partner.checked&&(partner.status=!1,$scope.listAcceptPartner.push(partner))}),partnerService.acceptPartner($scope.listAcceptPartner).then(function(){$scope.alertSuccess("Thành Công!","")},function(error){console.log(error)})},$scope.getAllWaitpartner=function(){partnerService.getAllWaitpartner().then(function(response){console.log(response),$scope.allWaitPartner=response.data,angular.forEach($scope.allWaitPartner,function(partner){partner.checked=!1}),$scope.totalItems=response.data.length,$scope.currentPage=1,$scope.entryLimit=10,$scope.entryLimit>$scope.totalItems&&($scope.entryLimit=$scope.totalItems),$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit),$scope.$watch("search",function(newVal,oldVal){$scope.filtered=filterFilter($scope.allWaitPartner,newVal),$scope.totalItems=$scope.filtered.length,$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit),$scope.currentPage=1},!0)},function(error){console.log(error)})},$scope.editPartner=function(partner){$scope.Partner=partner,console.log(partner)},$scope.editPartnerInfo=function(){$("#close_edit_partnerInfo").trigger("click"),partnerService.editPartner($scope.Partner.id,$scope.Partner).then(function(){$scope.alertSuccess("Sửa thông tin đối tác thành công!",""),$scope.loadAllPartner()},function(error){$scope.alertDanger(error.data.message,"")})},$scope.deletePartner=function(partnerId){$("#close_modal_delete_partner").trigger("click"),partnerService.deletePartner(partnerId).then(function(){$scope.alertSuccess("Xóa partner thành công!",""),"/fit-partner"==$rootScope.currentPageName&&$scope.getFitPartner(),"/other-partner"==$rootScope.currentPageName&&$scope.getOtherPartner(),$scope.loadAllPartner()},function(error){$scope.alertDanger(error.data.message,"")})},$scope.showFollow=function(follows){$scope.modelFollows=follows},$scope.getAllFollows=function(){partnerService.getAllFollows().then(function(response){console.log(response.data),$scope.allFollows=response.data},function(error){console.log(error)})},$scope.showPartnerContact=function(partner){alert(1),console.log(partner),$scope.partnerContacts=""!=partner?JSON.parse(partner):null},$scope.data={},$scope.click=function(){$scope.data.alert="Your browser doesn't support HTML5 input type='File'"};var fileSelect=document.createElement("input");fileSelect.type="file",fileSelect.disabled||($scope.click=function(){fileSelect.click()},fileSelect.onchange=function(){var f=fileSelect.files[0],r=new FileReader;r.onloadend=function(e){$scope.ima=e.target.result,$scope.editIma=!0,$scope.$apply()},r.readAsDataURL(f)},$scope.showPostModal=function(post){$scope.modalPost=post,console.log(post)},$scope.editPost=function(post){$scope.editPostModal=post},$scope.saveEditPost=function(){$scope.editIma,void 0!=$scope.editPostTimeModal.startDate&&($scope.request.startDate=new Date($scope.editPostTimeModal.startDate).getTime()/1e3),void 0!=$scope.editPostTimeModal.expiryTime&&($scope.request.expiryTime=new Date($scope.editPostTimeModal.expiryTime).getTime()),$scope.request.content=$scope.editPostModal.content,$scope.request.hashtagDTO=$scope.obj,$scope.request.requiredNumber=$scope.editPostModal.requiredNumber,$scope.request.title=$scope.editPostModal.title,$scope.request.partnerContactId=0,partnerService.editPost($scope.editPostModal.id,$scope.request).then(function(response){$("#close_modal_edit_post").trigger("click"),$scope.alertSuccess("Sửa post thành công","")},function(error){$("#close_modal_edit_post").trigger("click"),$scope.alertDanger("Có lỗi xảy ra, hãy thử lại!","")})},$scope.createPost=function(){if(""!=$scope.post.postType){if(""!=$scope.tags&&void 0!=$scope.tags){var array=$scope.tags.split(",");$scope.obj=[];for(var i=0;i<array.length;i++)$scope.obj.push({tag:array[i]})}"Research"==$scope.post.postType&&($scope.post.partnerContactId="no"),"other"==$scope.post.partnerContactId?$scope.post.partnerContactId=0:"no"==$scope.post.partnerContactId?$scope.post.partnerContactId=-1:$scope.post.partnerContactDTO=null,"other"==$scope.post.partner?($scope.partnerId=-1,$scope.post.partnerContactDTO=$scope.input.partnerContactDTO):($scope.partnerId=$scope.Partner.id,$scope.input.partner=null,angular.forEach($scope.Partner.partnerContacts,function(contact){$scope.post.partnerContactId=contact.id})),$scope.request={content:$scope.post.content,datePost:Date.now(),hashtagDTO:$scope.obj,partnerContactId:$scope.post.partnerContactId,requiredNumber:$scope.post.requiredNumber,title:$scope.post.title,expiryTime:new Date($scope.post.expiryTime).getTime(),partnerContactDTO:$scope.post.partnerContactDTO,partner:$scope.input.partner,postType:$scope.post.postType},void 0!=$scope.request.postType&&void 0!=$scope.partnerId&&(console.log($scope.partnerId),console.log($scope.request),partnerService.createPost($scope.partnerId,$scope.request).then(function(response){$scope.alertSuccess("Thêm post thành công",""),$scope.loadAllPost(),$scope.Partner=void 0,$scope.post={}},function(error){console.log(error),$scope.alertDanger(error.data.message,"")}))}},$scope.loadAllPostByInternshipTerm=function(){$stateParams.internshipTermId&&partnerService.loadAllPostByInternshipTerm($stateParams.internshipTermId).then(function(response){console.log(response),$scope.allPosts=response.data},function(error){console.log(error)})},$scope.loadAllPost=function(postType,stateParams){void 0!=stateParams&&($state.transitionTo("/post/page=:page",{page:1},{location:!0,notify:!1}),$stateParams.page=1),$stateParams.page&&(void 0!=postType&&(sessionStorage.setItem("postType",postType),$rootScope.postType=postType),void 0==sessionStorage.postType&&sessionStorage.setItem("postType","Recruitment"),void 0==$rootScope.postType&&($rootScope.postType=sessionStorage.postType),$scope.activePage=$stateParams.page,partnerService.loadLatestPost($stateParams.page-1,15,sessionStorage.postType).then(function(response){$scope.allPosts=response.data.content,$scope.pages=[];for(var page=response.data.totalPages,i=1;i<=page;i++)i==$stateParams.page?$scope.pages[i]={page:i,class:"active"}:$scope.pages[i]={page:i,class:""},$stateParams.page==page?$scope.nextPage={class:"disabled",page:page}:$scope.nextPage={class:"",page:parseInt($stateParams.page)+1},1==$stateParams.page?$scope.previousPage={class:"disabled",page:1}:$scope.previousPage={class:"",page:$stateParams.page-1};console.log(response.data)},function(error){console.log(error)}))},$scope.selectPartner=function(partner){""!=partner&&"other"!=partner?($scope.Partner=JSON.parse(partner),console.log($scope.Partner)):"other"==partner?$scope.input={}:$scope.partnerContact=null},$scope.entry="",$scope.paginate=function(){""!=$scope.entry?($scope.entry>$scope.totalItems?$scope.entryLimit=$scope.totalItems:$scope.entryLimit=$scope.entry,$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit)):($scope.entryLimit=25,$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit))},$scope.getOtherPartner=function(){partnerService.getOtherPartner().then(function(response){$scope.otherPartners=response.data,$scope.partners=response.data,$scope.totalItems=response.data.length,$scope.currentPage=1,$scope.entryLimit=10,$scope.entryLimit>$scope.totalItems&&($scope.entryLimit=$scope.totalItems),$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit),$scope.$watch("search",function(newVal,oldVal){$scope.filtered=filterFilter($scope.otherPartners,newVal),$scope.totalItems=$scope.filtered.length,$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit),$scope.currentPage=1},!0)})},$scope.getFitPartner=function(){partnerService.getFitPartner().then(function(response){console.log(response),$scope.fitPartners=response.data,$scope.partners=response.data,$scope.totalItems=response.data.length,$scope.currentPage=1,$scope.entryLimit=10,$scope.entryLimit>$scope.totalItems&&($scope.entryLimit=$scope.totalItems),$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit),$scope.$watch("search",function(newVal,oldVal){$scope.filtered=filterFilter($scope.fitPartners,newVal),$scope.totalItems=$scope.filtered.length,$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit),$scope.currentPage=1},!0)})},$scope.loadAllPartner=function(){$scope.loadPartner=!0,partnerService.loadAllPartner().then(function(data){console.log(data),$scope.partners=data.data,$scope.totalItems=data.data.length,$scope.currentPage=1,$scope.entryLimit=10,$scope.entryLimit>$scope.totalItems&&($scope.entryLimit=$scope.totalItems),$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit),$scope.$watch("search",function(newVal,oldVal){$scope.filtered=filterFilter($scope.partners,newVal),$scope.totalItems=$scope.filtered.length,$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit),$scope.currentPage=1},!0)})},$scope.deletePost=function(postId){partnerService.deletePost(postId).then(function(){$("#close_modal_delete_post").trigger("click"),$scope.alertSuccess("Xóa post thành công!",""),$scope.loadAllPost()},function(error){console.log(error),$("#close_modal_delete_post").trigger("click"),$scope.alertDanger("Có lỗi xảy ra, hãy reload và thử lại!","")})},$scope.deletePartnerContact=function(contactId){$("#close_modal_delete_partner_contact").trigger("click"),partnerService.deletePartnerContact(contactId).then(function(){$scope.alertSuccess("Xóa liên hệ thành công!","successdelete_edit"),$("#tr_contact_"+contactId).remove(),$scope.loadAllPartner()},function(error){$scope.alertDanger(error.data.message,"danger")})},$scope.editContact=function(contactId){console.log(contactId);var contactName=$("#contactName_"+contactId).text();$("#contactName_"+contactId).html('<input id="contactName_value_'+contactId+'" value="'+contactName+'" style="border-radius:3px; border: 1px solid;" ng-keydown="editContactEnter($event, '+contactId+')"/>');var email=$("#email_"+contactId).text();$("#email_"+contactId).html('<input id="email_value_'+contactId+'" value="'+email+'" style="border-radius:3px; border: 1px solid;" ng-keydown="editContactEnter($event, '+contactId+')"/>');var phone=$("#phone_"+contactId).text();$("#phone_"+contactId).html('<input id="phone_value_'+contactId+'" value="'+phone+'" style="border-radius:3px; border: 1px solid; width: 70%;" ng-keydown="editContactEnter($event, '+contactId+')"/>');var skype=$("#skype_"+contactId).text();$("#skype_"+contactId).html('<input id="skype_value_'+contactId+'" value="'+skype+'" style="border-radius:3px; border: 1px solid; width: 70%;" ng-keydown="editContactEnter($event, '+contactId+')"/>'),$("#edit_contact_"+contactId).hide(),$("#save_edit_contact_"+contactId).show()},$scope.editContactEnter=function($event,contactId){console.log(contactId),13==$event.keyCode&&(console.log(contactId),$("#save_edit_contact_"+contactId).trigger("click"))},$scope.saveEditContact=function(contactId){var contactName=$("#contactName_value_"+contactId).val(),email=$("#email_value_"+contactId).val(),phone=$("#phone_value_"+contactId).val(),skype=$("#skype_value_"+contactId).val();$scope.request={contactName:contactName,email:email,phone:phone,skype:skype},partnerService.editPartnerContact(contactId,$scope.request).then(function(){$("#edit_contact_"+contactId).show(),$("#save_edit_contact_"+contactId).hide(),$("#contactName_"+contactId).html(contactName),$("#email_"+contactId).html(email),$("#phone_"+contactId).html(phone),$("#skype_"+contactId).html(skype),$scope.alertSuccess("Sửa liên hệ thành công!","successdelete_edit")},function(error){console.log(error),$scope.alertDanger(error.data.message,"danger")})},$scope.confirmDelete=function(id,name){console.log(id),$scope.confirmDeleteId=id,$scope.confirmDeleteName=name},$scope.createPartner=function(){$scope.request={userName:$scope.partner.userName,password:md5.createHash($scope.partner.password||""),role:$scope.role.role},$scope.partner.password=md5.createHash($scope.partner.password||""),$scope.partner.role=$scope.role.role,console.log($scope.partner),partnerService.createPartner($scope.partner).then(function(data){$scope.partner={},$scope.alertSuccess("Tạo đối tác thành công!",""),$scope.loadAllPartner()},function(error){$scope.alertDanger("Có lỗi khi tạo đối tác, hãy reload trang và thử lại!",""),$scope.error=error})},$scope.getPartnerNameAndId=function(){partnerService.getPartnerNameAndId("true").then(function(response){$scope.partnerNameAndId=response.data},function(error){console.log(error)})},$scope.createPartnerContact=function(){partnerService.createPartnerContact($scope.input.partnerContact.partnerId,$scope.input.partnerContact).then(function(response){$scope.input.partnerContact={},$scope.alertSuccess("Thên liên hệ cho đối tác thành công!",""),$scope.loadAllPartner()},function(error){$scope.alertDanger(error.data.message,"")})},$scope.showPartner=function(data){$rootScope.partner=data,$location.path("/admin/partner/"+data.partnerId)},$scope.setPartnerInfo=function(){$scope.partnerData=[],$scope.partnerData.partnerName=$rootScope.partner.partnerName,"A"==$rootScope.partner.status?$scope.partnerData.status=!0:$scope.partnerData.status=!1,$scope.partnerData.userId=$rootScope.partner.userId,$scope.partnerData.partnerId=$rootScope.partner.partnerId},$scope.changeStatus=function(userId){studentService.changeStatus(userId).then(function(){1==$scope.partnerData.status?$scope.partnerData.status=!1:$scope.partnerData.status=!0,alert("user status changed")},function(error){})},$scope.showPartnerContact=function(partnerContact,partnerName,partnerId){$scope.partnerContacts=partnerContact,$scope.partnerName=partnerName,$scope.partnerId=partnerId},$scope.loadPartnerContact=function(partnerId,partnerName){$scope.partnerContact=[],$scope.partnerName=partnerName,partnerService.loadPartnerContact(partnerId).then(function(response){console.log(response.data),$scope.partnerContacts=response.data},function(error){console.log(error)})},$scope.loadAllPartnerPost=function(partnerId){$scope.allPartnerPost=[],partnerService.loadAllPartnerPost(partnerId).then(function(response){$scope.show_post=!1,$scope.allPartnerPost=response.data,angular.forEach($scope.allPartnerPost,function(post){partnerService.getFollowOfPost(post.id).then(function(respone){post.follow=respone.data.length})})},function(error){console.log(error)})},$scope.closePost=function(){$scope.show_post=!1},$scope.showPost=function(post){$scope.show_post=!0,$scope.post=post},$scope.loadPartner=function(){null!=$rootScope.partner?$scope.setPartnerInfo():partnerService.loadPartner($stateParams.partnerId).then(function(respone){console.log(respone.data),$scope.partnerData=[],$scope.partnerData.partnerName=respone.data.partnerName,"A"==respone.data.status?$scope.partnerData.status=!0:$scope.partnerData.status=!1,$scope.partnerData.userId=respone.data.userId,$scope.partnerData.partnerId=respone.data.partnerId})},$scope.alertWarning=function(warning,timeout){$scope.warningMessage=warning,$scope.warning=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.warning=!1,$scope.warningMessage=""})},timeout)},$scope.alertDanger=function(error,danger){$scope.errorMessage=error,"danger"==danger?($scope.danger_edit=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.danger_edit=!1})},6e3)):($scope.danger=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.danger=!1,$scope.errorMessage=""})},6e3))},$scope.alertSuccess=function(string,success){$scope.successMessage=string,"successdelete_edit"==success?($scope.successdelete_edit=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.successdelete_edit=!1})},3e3)):($scope.success=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.success=!1})},3e3))})}])}(),function(){angular.module("student",[]);angular.module("student").controller("studentCtrl",["lecturersService","internService","$scope","studentService","messageService","$timeout","$location","$rootScope","filterFilter","$stateParams","orderByFilter","$state","partnerService","$compile",function(lecturersService,internService,$scope,studentService,messageService,$timeout,$location,$rootScope,filterFilter,$stateParams,orderBy,$state,partnerService,$compile){function showInput_(data,id){$("."+data+"_"+id).after('<input type="text" value="'+data+'" ng-blur="hideInput('+data+","+id+')" id="input_'+data+"_"+id+'">')}$rootScope.currentPageName=$state.current.name,console.log($rootScope.currentPage),$scope.st={},$scope.st.infoBySchool={},$scope.st.infoBySchool.studentClass="",$scope.studentInfoBySchool=[],$scope.entry="",$scope.search="",$scope.input={},$scope.intern={},$scope.lecturers={},$scope.postTitle="",$scope.type=null,$scope.downloadTypeLecturers="",$scope.new=function(type){var count=0;$scope.currentPage=1,"false"==type?(angular.forEach($scope.allStudents,function(student){null==student.lecturers?(student.show=!0,count++):student.show=!1}),$scope.totalItems=count):"true"==type?(angular.forEach($scope.allStudents,function(student){null!=student.lecturers?(student.show=!0,count++):student.show=!1}),$scope.totalItems=count):angular.forEach($scope.allStudents,function(student){student.show=!0})},$scope.changeType=function(postType){"noFollow"==postType&&$scope.getStudentNoInternshipTerm(),"Recruitment_other"==postType&&($scope.typeName="Công ty ngoài"),"Recruitment"==postType&&($scope.typeName="Đối tác"),"Research"==postType&&($scope.typeName="Tại trường"),""==postType&&($scope.typeName=""),$scope.currentPage=1;var count=0;"noFollow"!=postType&&""!=postType&&(angular.forEach($scope.allFollows,function(v){v.postTitle==postType&&count++}),$scope.totalItems=count)},$scope.filterPosttitle=function(item){return""==$scope.postTitle?item:item.postTitle==$scope.postTitle?item:void 0},$scope.getCount=function(){if(""!=$scope.postTitle)return filterFilter($scope.allFollows,{postTitle:$scope.postTitle}).length},$scope.emptyOrNull=function(item){return"true"==$scope.type?null===item.lecturers:!(null===item.lecturers)},$scope.getCountStudentNoFollow=function(){studentService.getCountStudentNoFollow().then(function(response){console.log(response.data)},function(error){console.log(error)})},$scope.getStudentNoInternshipTerm=function(){studentService.getStudentNoInternshipTerm().then(function(response){console.log(response),$scope.noFollows=response.data,$scope.totalItemsnoFollows=response.data.length,$scope.currentPagenoFollows=1,$scope.entryLimitnoFollows=25,$scope.entryLimitnoFollows>$scope.totalItemsnoFollows&&($scope.entryLimitnoFollows=$scope.totalItemsnoFollows),$scope.noOfPagesnoFollows=Math.ceil($scope.totalItemsnoFollows/$scope.entryLimitnoFollows),$scope.$watch("search",function(newVal,oldVal){$scope.filterednoFollows=filterFilter($scope.noFollows,newVal),$scope.totalItemsnoFollows=$scope.filterednoFollows.length,$scope.noOfPagesnoFollows=Math.ceil($scope.totalItemsnoFollows/$scope.entryLimitnoFollows),$scope.currentPagenoFollows=1},!0)})},$scope.removeLecturers=function(studentId){studentService.removeLecturers(studentId).then(function(){$("#delete_student").trigger("click"),$scope.alertSuccess("Xóa giảng viên cho sinh viên thành công!",""),$("#lecturers_"+studentId).text("")},function(error){$scope.alertDanger(error.data.message,"danger_edit")})},$scope.deleteIntern=function(internId,studentId){internService.deleteIntern(internId).then(function(response){$("#delete_student").trigger("click"),$("#close_modal_delete_intern").trigger("click"),$scope.alertSuccess("Xóa internship thành công!",""),$(".internship_"+studentId).text("")},function(error){$scope.alertDanger(error.data.message,"danger_edit")})},$scope.createInternship=function(){"other"!=$scope.intern.partnerId&&"other"!=$scope.intern.partnerNotFitId||($scope.intern.partnerId=0),"other"!=$scope.intern.partnerNotFitId&&($scope.intern.partnerId=$scope.intern.partnerNotFitId),console.log($scope.intern),internService.createIntern($scope.intern).then(function(response){$scope.alertSuccess("Tạo internship thành công!",""),$scope.intern={},$scope.getAllStudentByInternshipTerm(),"other"==$scope.intern.partnerNotFitId&&$scope.getNameAndIdOfPartners},function(error){$scope.alertDanger(error.data.message,"")})},$scope.entry="",$scope.paginate=function(){""!=$scope.entry?($scope.entry>$scope.totalItems?$scope.entryLimit=$scope.totalItems:$scope.entryLimit=$scope.entry,$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit)):($scope.entryLimit=25,$scope.entryLimit>$scope.totalItems&&($scope.entryLimit=$scope.totalItems),$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit))},$scope.entrynoFollows="",$scope.paginatenoFollows=function(){""!=$scope.entrynoFollows?($scope.entrynoFollows>$scope.totalItemsnoFollows?$scope.entryLimitnoFollows=$scope.totalItemsnoFollows:$scope.entryLimitnoFollows=$scope.entrynoFollows,$scope.noOfPagesnoFollows=Math.ceil($scope.totalItemsnoFollows/$scope.entryLimitnoFollows)):($scope.entryLimitnoFollows=25,$scope.entryLimitnoFollows>$scope.totalItemsnoFollows&&($scope.entryLimitnoFollows=$scope.totalItemsnoFollows),$scope.noOfPagesnoFollows=Math.ceil($scope.totalItemsnoFollows/$scope.entryLimitnoFollows))},$scope.getAllStudentNoLecturers=function(){internService.getAllStudentNoLecturers().then(function(response){console.log(response.data),$scope.propertyName="-infoBySchool.studentClass",$scope.reverse=!0,$scope.allStudentNoLecturers=response.data,$scope.allStudentNoLecturers=orderBy($scope.allStudentNoLecturers,$scope.propertyName,$scope.reverse),$scope.totalItems=response.data.length,$scope.currentPage=1,$scope.entryLimit=25,$scope.entryLimit>$scope.totalItems&&($scope.entryLimit=$scope.totalItems),$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit),$scope.$watch("search",function(newVal,oldVal){$scope.filtered=filterFilter($scope.allStudentNoLecturers,newVal),$scope.totalItems=$scope.filtered.length,$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit),$scope.currentPage=1},!0)},function(error){console.log(error)})},$scope.getAllStudentNoLecturersLastInternshipTerm=function(){internService.getAllStudentNoLecturersLastInternshipTerm().then(function(response){console.log(response.data),$scope.propertyName="-infoBySchool.studentClass",$scope.reverse=!0,$scope.allStudentNoLecturers=response.data,$scope.allStudentNoLecturers=orderBy($scope.allStudentNoLecturers,$scope.propertyName,$scope.reverse),$scope.totalItems=response.data.length,$scope.currentPage=1,$scope.entryLimit=25,$scope.entryLimit>$scope.totalItems&&($scope.entryLimit=$scope.totalItems),$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit),$scope.$watch("search",function(newVal,oldVal){$scope.filtered=filterFilter($scope.allStudentNoLecturers,newVal),$scope.totalItems=$scope.filtered.length,$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit),$scope.currentPage=1},!0)},function(error){console.log(error)})},$scope.getNameAndIdOfLecturers=function(){internService.getNameAndIdOfLecturers().then(function(response){console.log(response),$scope.nameAndIdOfLecturers=response.data},function(error){console.log(error)})},$scope.getNameAndIdOfPartnersFit=function(){internService.getNameAndIdOfPartners("true").then(function(response){console.log(response),$scope.nameAndIdPartnersFit=response.data},function(error){console.log(error)})},$scope.getNameAndIdOfPartners=function(){internService.getNameAndIdOfPartners("false").then(function(response){console.log(response),$scope.nameAndIdPartners=response.data},function(error){console.log(error)})},$scope.saveScore=function(id){var diem=$("#input_diem_"+id).val();if(!isNaN(diem)){console.log($("#input_diem_"+id).val());var index=$scope.allStudents.findIndex(x=>x.id===id);-1!=index&&(console.log($scope.allStudents[index].internship.id),studentService.addScore($scope.allStudents[index].internship.id,diem).then(function(){$("#diem_thuc_tap_"+id).html(diem)}))}},$scope.cancel=function(id){var index=$scope.allStudents.findIndex(x=>x.id===id);-1!=index&&(null==$scope.allStudents[index].internship.score?$("#diem_thuc_tap_"+id).html('<td class=" " id="diem_thuc_tap_'+id+'">Chưa có</td>'):$("#diem_thuc_tap_"+id).html('<td class=" " id="diem_thuc_tap_'+id+'">'+$scope.allStudents[index].internship.score+"</td>"))},$scope.addScore=function(){angular.forEach($scope.allStudents,function(intern){null==intern.internship&&(intern.internship={}),htmlVar='<input type="text" style="width: 40px; padding-right: 7px;" id="input_diem_'+intern.id+'">    <button ng-click="saveScore('+intern.id+')" class="btn btn-success btn-xs" style="padding-left: 10px;">Lưu</button><button class="btn btn-danger btn-xs" ng-click="cancel('+intern.id+')">Hủy</button>',-1!=$("#diem_thuc_tap_"+intern.id).text().indexOf("Chưa có")&&-1!=$("#bao_cao_"+intern.id).text().indexOf("View")&&$("#diem_thuc_tap_"+intern.id).html($compile(htmlVar)($scope))})},$scope.getInternOfLecturers=function(){internService.getInternOfLecturers($rootScope.lecturersId).then(function(response){console.log(response.data),$scope.allStudents=response.data},function(error){console.log(error)})},$scope.addLecturersStudent=function(){internService.addLecturersStudent($scope.listStudent,$scope.lecturers.lecturersId).then(function(){$scope.alertSuccess("Thêm giảng viên thành công!",""),$scope.getAllStudentNoLecturers(),$scope.listStudent=[]},function(error){console.log(error),$scope.alertDanger(error.data.message,"")})},$scope.getAllLecturers=function(){lecturersService.getAllLecturers().then(function(response){$scope.allLecturers=response.data},function(error){console.log(error)})},$scope.listStudent=[],$scope.addStudent=function(student){if(1==student.checked)$scope.listStudent.push({id:student.id,studentName:student.fullName,emailVNU:student.infoBySchool.emailvnu});else{var index=$scope.listStudent.findIndex(x=>x.id===student.id);$scope.listStudent.splice(index,1)}},$scope.removeStudent=function(index,studentId){$scope.listStudent.splice(index,1);var index=$scope.allStudents.findIndex(x=>x.id===studentId);$scope.allStudents[index].checked=!1},$scope.createListStudentToAddLecturers=function(){$scope.listStudent=[],angular.forEach($scope.allInterns,function(intern){1==intern.checked&&$scope.listStudent.push({id:intern.id,studentName:intern.student.fullName})}),console.log($scope.listStudent)},$scope.getAllInternshipTerm=function(){internService.getAllInternshipTerm().then(function(response){console.log(response.data),$scope.allInternshipTerm=response.data,$rootScope.lastInternshipTermId=$scope.allInternshipTerm[$scope.allInternshipTerm.length-1].id},function(error){console.log(error)})},$scope.getAllPost=function(){partnerService.loadAllPostByInternshipTerm(1).then(function(response){console.log(response),$scope.allposts=response.data})},$scope.selectPost=function(postId){$scope.postId=postId},$scope.asd=function(){console.log($scope.listStudent),console.log($scope.postId),angular.forEach($scope.listStudent,function(student){studentService.addFollow(student.emailVNU,$scope.postId).then(function(){},function(errors){console.log(student)})})},$scope.getAllStudentByInternshipTerm=function(lastInternshipTerm){void 0==$stateParams.internshipTermId&&void 0==lastInternshipTerm?internService.getAllInternshipTerm().then(function(response){console.log(response.data),$scope.allInternshipTerm=response.data,length=$scope.allInternshipTerm.length-1,$scope.lastInternTermId=$scope.allInternshipTerm[length].id,console.log($scope.lastInternTermId),internService.getAllStudentByInternshipTerm($scope.lastInternTermId).then(function(response){$scope.allStudents=response.data,$scope.propertyName="-infoBySchool.studentClass",$scope.reverse=!0,$scope.allStudents=orderBy($scope.allStudents,$scope.propertyName,$scope.reverse),angular.forEach($scope.allStudents,function(student){student.show=!0,student.checked=!1}),$scope.internshipName=" Đợt "+$scope.allInternshipTerm[length].term+" năm "+$scope.allInternshipTerm[length].year,$scope.totalItems=response.data.length,$scope.currentPage=1,$scope.entryLimit=10,$scope.entryLimit>$scope.totalItems&&($scope.entryLimit=$scope.totalItems),$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit),$scope.$watch("search",function(newVal,oldVal){$scope.filtered=filterFilter($scope.allStudents,newVal),$scope.totalItems=$scope.filtered.length,$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit),$scope.currentPage=1},!0)},function(error){console.log(error)})},function(error){console.log(error)}):void 0!=lastInternshipTerm&&""!=lastInternshipTerm?"all"==lastInternshipTerm||($scope.lastInternshipTerm=JSON.parse(lastInternshipTerm),internService.getAllStudentByInternshipTerm($scope.lastInternshipTerm.id).then(function(response){$scope.allStudents=response.data,$scope.internshipName=" Đợt "+$scope.lastInternshipTerm.term+" năm "+$scope.lastInternshipTerm.year,$scope.totalItems=response.data.length,$scope.currentPage=1,$scope.entryLimit=25,$scope.entryLimit>$scope.totalItems&&($scope.entryLimit=$scope.totalItems),$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit),$scope.$watch("search",function(newVal,oldVal){$scope.filtered=filterFilter($scope.allStudents,newVal),$scope.totalItems=$scope.filtered.length,$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit),$scope.currentPage=1},!0),console.log(response)},function(error){console.log(error)})):void 0!=$stateParams.internshipTermId&&internService.getAllStudentByInternshipTerm($stateParams.internshipTermId).then(function(response){$scope.allStudents=response.data,console.log(response)},function(error){console.log(error)})},$scope.getAllInternshipByInternshipTerm=function(){internService.getAllInternshipByInternshipTerm($stateParams.internshipTermId).then(function(response){$scope.allInterns=response.data,console.log(response)},function(error){console.log(error)})},$scope.loadAllInternshipTermPost=function(internshipTermId){internService.loadPostOfInternshipTerm(internshipTermId).then(function(response){$scope.allPosts=response.data},function(error){console.log(error)})},$scope.closePost=function(){$scope.show_post=!1},$scope.showPost=function(post){$scope.show_post=!0,$scope.post=post},$scope.alertDate=function(){console.log($scope.input.startDate)},$scope.createInternshipTerm=function(){""!=$scope.input.year&&""!=$scope.input.startDate&&""!=$scope.input.endDate&&(console.log($scope.input.startDate),internService.createInternshipTerm($scope.input).then(function(response){$scope.alertSuccess("Tạo kì thực tập thành công!",""),$scope.input.year="",$scope.input.endDate="",$scope.input.startDate="",$scope.getAllInternshipTerm()},function(error){$scope.alertDanger(error.message,"")}))},$scope.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],$scope.format=$scope.formats[0],$scope.altInputFormats=["M!/d!/yyyy"],$scope.dateOptions={formatYear:"yy",maxDate:new Date(2020,5,22),minDate:new Date,startingDay:1},$scope.open2=function(){$scope.popup2={},$scope.popup2.opened=!0},$scope.editInternshipTerm=function(startDate,endDate,internshipTermId){startDate=new Date,$("#internshipTerm_"+internshipTermId).val(startDate);var curr_date=startDate.getDate(),curr_month=startDate.getMonth()+1;startDate=startDate.getFullYear()+"-"+curr_month+"-"+curr_date},$scope.saveEditinternshipTerm=function(internshipTerm){internService.editInternshipTerm(internshipTerm).then(function(){$scope.alertSuccess("Sửa kì thực tập thành công!","")},function(error){$scope.alertDanger(error.data.message,"")})},$scope.comfirmDelete=function(id){$scope.comfirmDeleteId=id},$scope.deleteInternshipTerm=function(id){internService.deleteInternshipTerm(id).then(function(){$("#close_modal_delete_internship_term").trigger("click"),$scope.alertSuccess("Xóa kì thực tập thành công!",""),$scope.getAllInternshipTerm()},function(error){$("#close_modal_delete_internship_term").trigger("click"),$scope.alertDanger("Không thể xóa kì thực tập này!","")})},$scope.convertStudent1=function(){var xlf=document.getElementById("xlf1");xlf.addEventListener&&xlf.addEventListener("change",function(e){var i,f,files=e.target.files;for(f=files[i=0];i!=files.length;++i){var reader=new FileReader;f.name,reader.onload=function(e){var data=e.target.result,workbook=XLSX.read(data,{type:"binary"}),first_sheet_name=workbook.SheetNames[0],worksheet=workbook.Sheets[first_sheet_name];worksheet.A1.w="fullName",$rootScope.excelStudent1=XLSX.utils.sheet_to_json(worksheet)},reader.readAsBinaryString(f)}},!1)},$scope.convertStudent2=function(){var xlf=document.getElementById("xlf2");xlf.addEventListener&&xlf.addEventListener("change",function(e){var i,f,files=e.target.files;for(f=files[i=0];i!=files.length;++i){var reader=new FileReader;f.name,reader.onload=function(e){var data=e.target.result,workbook=XLSX.read(data,{type:"binary"}),first_sheet_name=workbook.SheetNames[0],worksheet=workbook.Sheets[first_sheet_name];worksheet.A1.w="fullName",$rootScope.excelStudent2=XLSX.utils.sheet_to_json(worksheet)},reader.readAsBinaryString(f)}},!1)},$scope.checkStudent=function(){console.log(635),$scope.student1=$rootScope.excelStudent1,$scope.student2=$rootScope.excelStudent2;var stt=1;angular.forEach($scope.student1,function(v){void 0!=v.fullName?v.fullName=v.fullName.trim().toLowerCase():console.log(v)}),angular.forEach($scope.student2,function(v){void 0!=v.fullName?v.fullName=v.fullName.trim().toLowerCase():console.log(v)}),angular.forEach($scope.student2,function(student2){student2.stt=stt;var index=$scope.student1.findIndex(x=>x.fullName===student2.fullName);-1!=index&&(student2.checked=!0,$scope.student1[index].checked=!0),stt++}),angular.forEach($scope.student2,function(student){1!=student.checked&&(console.log(student.stt+"-"+student.fullName),$("#student_2_"+student.stt).css("background-color","#f0ad4e"))}),angular.forEach($scope.student1,function(student){1!=student.checked&&$("#student_1_"+student.stt).css("background-color","#f0ad4e")})},$scope.convertNolecturers=function(){var xlf=document.getElementById("xlf");xlf.addEventListener&&xlf.addEventListener("change",function(e){var i,f,files=e.target.files;for(f=files[i=0];i!=files.length;++i){var reader=new FileReader;f.name,reader.onload=function(e){var data=e.target.result,workbook=XLSX.read(data,{type:"binary"}),first_sheet_name=workbook.SheetNames[0],worksheet=workbook.Sheets[first_sheet_name];worksheet.A1.w="stt",worksheet.B1.w="fullName",worksheet.C1.w="class",worksheet.D1.w="email",worksheet.E1.w="lecturers",worksheet.F1.w="lecturersEmail",$rootScope.excel=XLSX.utils.sheet_to_json(worksheet)},reader.readAsBinaryString(f)}},!1)},$scope.editEmail=function($event,data){13==$event.keyCode&&(data.editEmail=data.stt)},$scope.editLecturers=function($event,data){13==$event.keyCode&&(data.editLecturers=data.stt)},$scope.checkData=function(){console.log($rootScope.excel),void 0==$scope.noLecturers&&($scope.noLecturers=$rootScope.excel),void 0!=$scope.error&&0!=$scope.errors.length&&(console.log($scope.errors),angular.forEach($scope.errors,function(v){$("#email_"+v.stt).css("background-color",""),$("#lecturers_email_"+v.stt).css("background-color","")})),$scope.errors=[],studentService.checkExcelLecturersAssignment($scope.noLecturers).then(function(response){angular.forEach(response.data,function(v){var count=0;"nf"==v.email&&($("#email_"+v.stt).css("background-color","#f0ad4e"),count++),"nf"==v.lecturersEmail&&($("#lecturers_email_"+v.stt).css("background-color","#f0ad4e"),count++),0!=count&&($scope.error={error:"Dữ liệu ở dòng "+v.stt+" chưa chính xác",stt:v.stt},$scope.errors.push($scope.error))}),console.log($scope.errors),0==$scope.errors.length?$scope.checkExcel=!0:$scope.checkExcel=!1},function(error){console.log(error)})},$scope.upload=function(){studentService.LecturersAssignmentExcel($scope.noLecturers).then(function(){$scope.alertSuccess("Thêm giảng viên thành công!",""),$scope.noLecturers=void 0,$rootScope.excel=void 0,$scope.getAllStudentNoLecturersLastInternshipTerm()},function(error){console.log(error),$scope.alertDanger("Có lỗi xảy ra, hãy thử kiểm tra lại danh sách!","")})},$scope.getAllStudentClass=function(){studentService.getAllStudentClass().then(function(response){console.log(response),$scope.allStudentClass=response.data},function(error){console.log(error)})},$scope.changedownloadType=function(downloadTypeLecturers,downloadType){""==downloadType&&($scope.st.infoBySchool.studentClass="")},$scope.changedownload=function(downloadType){""==downloadType&&($scope.st.infoBySchool.studentClass="")},$scope.exportDataNoLecturers=function(){function s2ab(s){for(var buf=new ArrayBuffer(s.length),view=new Uint8Array(buf),i=0;i!=s.length;++i)view[i]=255&s.charCodeAt(i);return buf}var count=0;console.log($scope.allStudents.length);var wb={};wb.Sheets={},wb.SheetNames=[];var wscols=[];wscols[1]={wpx:150},wscols[2]={wpx:100},wscols[3]={wpx:200},wscols[4]={wpx:200},wscols[5]={wpx:100},wscols[6]={wpx:200},wscols[7]={wpx:200};var ws={"!ref":"A1:H"+($scope.allStudents.length+1)};ws["!cols"]=wscols;var i=2;ws.A1={h:"STT",r:"STT",t:"s",v:"STT",w:"STT"},ws.B1={h:"Họ và tên",r:"Họ và tên",t:"s",v:"Họ và tên",w:"Họ và tên"},ws.C1={h:"Lớp",r:"Lớp",t:"s",v:"Lớp",w:"Lớp"},ws.D1={h:"VNU email",r:"VNU email",t:"s",v:"VNU email",w:"VNU email"},ws.D1={h:"VNU email",r:"VNU email",t:"s",v:"VNU email",w:"VNU email"},ws.D1={h:"VNU email",r:"VNU email",t:"s",v:"VNU email",w:"VNU email"},ws.E1={h:"Email",r:"Email",t:"s",v:"Email",w:"Email"},ws.F1={h:"Phone",r:"Phone",t:"s",v:"Phone",w:"Phone"},ws.G1={h:"Giảng viên",r:"Giảng viên",t:"s",v:"Giảng viên",w:"Giảng viên"},ws.H1={h:"Email vnu của giảng viên",r:"Email vnu của giảng viên",t:"s",v:"Email vnu của giảng viên",w:"Email vnu của giảng viên"},ws.I1={h:"Nơi thực tập",r:"Nơi thực tập",t:"s",v:"Nơi thực tập",w:"Nơi thực tập"};var stt=1;angular.forEach($scope.allStudents,function(student){null==student.infoBySchool.studentClass&&(student.infoBySchool.studentClass=""),""==$scope.downloadTypeLecturers?-1==student.infoBySchool.studentClass.toLowerCase().indexOf($scope.st.infoBySchool.studentClass.toLowerCase())&&""!=$scope.st.infoBySchool.studentClass||(ws["A"+i]={h:stt,r:stt,t:"s",v:stt,w:stt,s:{alignment:{wrapText:!0,vertical:"center"}}},ws["B"+i]={h:student.fullName,r:student.fullName,t:"s",v:student.fullName,w:student.fullName,s:{alignment:{wrapText:!0,vertical:"center"}}},null==student.infoBySchool.studentClass&&(student.infoBySchool.studentClass=""),null==student.infoBySchool.grade&&(student.infoBySchool.grade=""),ws["C"+i]={h:student.infoBySchool.grade+student.infoBySchool.studentClass,r:student.infoBySchool.grade+student.infoBySchool.studentClass,t:"s",v:student.infoBySchool.grade+student.infoBySchool.studentClass,w:student.infoBySchool.grade+student.infoBySchool.studentClass,s:{alignment:{wrapText:!0,vertical:"center"}}},ws["D"+i]={h:student.infoBySchool.emailvnu,r:student.infoBySchool.emailvnu,t:"s",v:student.infoBySchool.emailvnu,w:student.infoBySchool.emailvnu,s:{alignment:{wrapText:!0,vertical:"center"}}},null!=student.email&&(ws["E"+i]={h:student.email,r:student.email,t:"s",v:student.email,w:student.email,s:{alignment:{wrapText:!0,vertical:"center"}}}),null!=student.phoneNumber&&(ws["F"+i]={h:student.phoneNumber,r:student.phoneNumber,t:"s",v:student.phoneNumber,w:student.phoneNumber,s:{alignment:{wrapText:!0,vertical:"center"}}}),null!=student.lecturers&&(ws["G"+i]={h:student.lecturers.fullName,r:student.lecturers.fullName,t:"s",v:student.lecturers.fullName,w:student.lecturers.fullName,s:{alignment:{wrapText:!0,vertical:"center"}}},ws["H"+i]={h:student.lecturers.emailVNU,r:student.lecturers.emailVNU,t:"s",v:student.lecturers.emailVNU,w:student.lecturers.emailVNU,s:{alignment:{wrapText:!0,vertical:"center"}}}),i++,count++,stt++):"noLecturers"==$scope.downloadTypeLecturers?-1==student.infoBySchool.studentClass.toLowerCase().indexOf($scope.st.infoBySchool.studentClass.toLowerCase())&&""!=$scope.st.infoBySchool.studentClass||null==student.lecturers&&(ws["A"+i]={h:stt,r:stt,t:"s",v:stt,w:stt,s:{alignment:{wrapText:!0,vertical:"center"}}},ws["B"+i]={h:student.fullName,r:student.fullName,t:"s",v:student.fullName,w:student.fullName,s:{alignment:{wrapText:!0,vertical:"center"}}},null==student.infoBySchool.studentClass&&(student.infoBySchool.studentClass=""),null==student.infoBySchool.grade&&(student.infoBySchool.grade=""),ws["C"+i]={h:student.infoBySchool.grade+student.infoBySchool.studentClass,r:student.infoBySchool.grade+student.infoBySchool.studentClass,t:"s",v:student.infoBySchool.grade+student.infoBySchool.studentClass,w:student.infoBySchool.grade+student.infoBySchool.studentClass,s:{alignment:{wrapText:!0,vertical:"center"}}},ws["D"+i]={h:student.infoBySchool.emailvnu,r:student.infoBySchool.emailvnu,t:"s",v:student.infoBySchool.emailvnu,w:student.infoBySchool.emailvnu,s:{alignment:{wrapText:!0,vertical:"center"}}},null!=student.email&&(ws["E"+i]={h:student.email,r:student.email,t:"s",v:student.email,w:student.email,s:{alignment:{wrapText:!0,vertical:"center"}}}),null!=student.phoneNumber&&(ws["F"+i]={h:student.phoneNumber,r:student.phoneNumber,t:"s",v:student.phoneNumber,w:student.phoneNumber,s:{alignment:{wrapText:!0,vertical:"center"}}}),i++,count++,stt++):"lecturers"==$scope.downloadTypeLecturers&&(-1==student.infoBySchool.studentClass.toLowerCase().indexOf($scope.st.infoBySchool.studentClass.toLowerCase())&&""!=$scope.st.infoBySchool.studentClass||null!=student.lecturers&&(ws["A"+i]={h:stt,r:stt,t:"s",v:stt,w:stt,s:{alignment:{wrapText:!0,vertical:"center"}}},ws["B"+i]={h:student.fullName,r:student.fullName,t:"s",v:student.fullName,w:student.fullName,s:{alignment:{wrapText:!0,vertical:"center"}}},null==student.infoBySchool.studentClass&&(student.infoBySchool.studentClass=""),null==student.infoBySchool.grade&&(student.infoBySchool.grade=""),ws["C"+i]={h:student.infoBySchool.grade+student.infoBySchool.studentClass,r:student.infoBySchool.grade+student.infoBySchool.studentClass,t:"s",v:student.infoBySchool.grade+student.infoBySchool.studentClass,w:student.infoBySchool.grade+student.infoBySchool.studentClass,s:{alignment:{wrapText:!0,vertical:"center"}}},ws["D"+i]={h:student.infoBySchool.emailvnu,r:student.infoBySchool.emailvnu,t:"s",v:student.infoBySchool.emailvnu,w:student.infoBySchool.emailvnu,s:{alignment:{wrapText:!0,vertical:"center"}}},null!=student.email&&(ws["E"+i]={h:student.email,r:student.email,t:"s",v:student.email,w:student.email,s:{alignment:{wrapText:!0,vertical:"center"}}}),null!=student.phoneNumber&&(ws["F"+i]={h:student.phoneNumber,r:student.phoneNumber,t:"s",v:student.phoneNumber,w:student.phoneNumber,s:{alignment:{wrapText:!0,vertical:"center"}}}),ws["G"+i]={h:student.lecturers.fullName,r:student.lecturers.fullName,t:"s",v:student.lecturers.fullName,w:student.lecturers.fullName,s:{alignment:{wrapText:!0,vertical:"center"}}},ws["H"+i]={h:student.lecturers.emailVNU,r:student.lecturers.emailVNU,t:"s",v:student.lecturers.emailVNU,w:student.lecturers.emailVNU,s:{alignment:{wrapText:!0,vertical:"center"}}},i++,count++,stt++))}),wb.SheetNames.push("Student List"),wb.Sheets["Student List"]=ws;var wbout=XLSX.write(wb,{bookType:"xlsx",bookSST:!1,type:"binary"});0==count?$scope.alertWarning("Tên lớp không trùng!",5e3):(""==$scope.st.infoBySchool.studentClass?saveAs(new Blob([s2ab(wbout)],{type:""}),"Student List - All.xlsx"):saveAs(new Blob([s2ab(wbout)],{type:""}),"Registration List - "+$scope.st.infoBySchool.studentClass+".xlsx"),$scope.alertSuccess("Xuất danh sách thành công!",""),$scope.st.infoBySchool.studentClass="")},$scope.exportDataRegistration=function(){function s2ab(s){for(var buf=new ArrayBuffer(s.length),view=new Uint8Array(buf),i=0;i!=s.length;++i)view[i]=255&s.charCodeAt(i);return buf}console.log($scope.allFollows);var count=0,wb={};wb.Sheets={},wb.SheetNames=[];var wscols=[];wscols[0]={wpx:200},wscols[1]={wpx:150},wscols[2]={wpx:100},wscols[3]={wpx:200},wscols[4]={wpx:200},wscols[5]={wpx:200},wscols[6]={wpx:150};var ws={"!ref":"A1:H"+($scope.allFollows.length+1)};ws["!cols"]=wscols;var i=2;ws.A1={h:"Student Name",r:"Student Name",t:"s",v:"Student Name",w:"Student Name"},ws.B1={h:"Student Code",r:"Student Code",t:"s",v:"Student Code",w:"Student Code"},ws.C1={h:"Class",r:"Class",t:"s",v:"Class",w:"Class"},ws.D1={h:"VNU email",r:"VNU email",t:"s",v:"VNU email",w:"VNU email"},ws.E1={h:"Email",r:"Email",t:"s",v:"Email",w:"Email"},ws.F1={h:"Phone",r:"Phone",t:"s",v:"Phone",w:"Phone"},ws.G1={h:"Company",r:"Company",t:"s",v:"Company",w:"Company"},ws.H1={h:"Type",r:"Type",t:"s",v:"Type",w:"Type"};var name="";angular.forEach($scope.allFollows,function(follow){""!=$scope.postTitle?follow.postTitle==$scope.postTitle&&(-1==follow.partnerName.toLowerCase().indexOf($scope.search.toLowerCase())&&""!=$scope.search||(name=follow.partnerName,ws["A"+i]={h:follow.student.fullName,r:follow.student.fullName,t:"s",v:follow.student.fullName,w:follow.student.fullName,s:{alignment:{wrapText:!0,vertical:"center"}}},null!=follow.student.infoBySchool.studentCode&&(ws["B"+i]={h:follow.student.infoBySchool.studentCode,r:follow.student.infoBySchool.studentCode,t:"s",v:follow.student.infoBySchool.studentCode,w:follow.student.infoBySchool.studentCode,s:{alignment:{wrapText:!0,vertical:"center"}}}),null!=follow.student.infoBySchool.studentClass&&(ws["C"+i]={h:"K"+follow.student.infoBySchool.grade+follow.student.infoBySchool.studentClass,r:"K"+follow.student.infoBySchool.grade+follow.student.infoBySchool.studentClass,t:"s",v:"K"+follow.student.infoBySchool.grade+follow.student.infoBySchool.studentClass,w:"K"+follow.student.infoBySchool.grade+follow.student.infoBySchool.studentClass,s:{alignment:{wrapText:!0,vertical:"center"}}}),ws["D"+i]={h:follow.student.infoBySchool.emailvnu,r:follow.student.infoBySchool.emailvnu,t:"s",v:follow.student.infoBySchool.emailvnu,w:follow.student.infoBySchool.emailvnu,s:{alignment:{wrapText:!0,vertical:"center"}}},null!=follow.student.email&&(ws["E"+i]={h:follow.student.email,r:follow.student.email,t:"s",v:follow.student.email,w:follow.student.email,s:{alignment:{wrapText:!0,vertical:"center"}}}),null!=follow.student.phoneNumber&&(ws["F"+i]={h:follow.student.phoneNumber,r:follow.student.phoneNumber,t:"s",v:follow.student.phoneNumber,w:follow.student.phoneNumber,s:{alignment:{wrapText:!0,vertical:"center"}}}),ws["G"+i]={h:follow.partnerName,r:follow.partnerName,t:"s",v:follow.partnerName,w:follow.partnerName,s:{alignment:{wrapText:!0,vertical:"center"}}},""==$scope.typeName||void 0==$scope.typeName?ws["H"+i]={h:follow.postTitle,r:follow.postTitle,t:"s",v:follow.postTitle,w:follow.postTitle,s:{alignment:{wrapText:!0,vertical:"center"}}}:ws["H"+i]={h:$scope.typeName,r:$scope.typeName,t:"s",v:$scope.typeName,w:$scope.typeName,s:{alignment:{wrapText:!0,vertical:"center"}}},i++,count++)):-1==follow.partnerName.toLowerCase().indexOf($scope.search.toLowerCase())&&""!=$scope.search||(name=follow.partnerName,ws["A"+i]={h:follow.student.fullName,r:follow.student.fullName,t:"s",v:follow.student.fullName,w:follow.student.fullName,s:{alignment:{wrapText:!0,vertical:"center"}}},null!=follow.student.infoBySchool.studentCode&&(ws["B"+i]={h:follow.student.infoBySchool.studentCode,r:follow.student.infoBySchool.studentCode,t:"s",v:follow.student.infoBySchool.studentCode,w:follow.student.infoBySchool.studentCode,s:{alignment:{wrapText:!0,vertical:"center"}}}),null!=follow.student.infoBySchool.studentClass&&(ws["C"+i]={h:"K"+follow.student.infoBySchool.grade+follow.student.infoBySchool.studentClass,r:"K"+follow.student.infoBySchool.grade+follow.student.infoBySchool.studentClass,t:"s",v:"K"+follow.student.infoBySchool.grade+follow.student.infoBySchool.studentClass,w:"K"+follow.student.infoBySchool.grade+follow.student.infoBySchool.studentClass,s:{alignment:{wrapText:!0,vertical:"center"}}}),ws["D"+i]={h:follow.student.infoBySchool.emailvnu,r:follow.student.infoBySchool.emailvnu,t:"s",v:follow.student.infoBySchool.emailvnu,w:follow.student.infoBySchool.emailvnu,s:{alignment:{wrapText:!0,vertical:"center"}}},null!=follow.student.email&&(ws["E"+i]={h:follow.student.email,r:follow.student.email,t:"s",v:follow.student.email,w:follow.student.email,s:{alignment:{wrapText:!0,vertical:"center"}}}),null!=follow.student.phoneNumber&&(ws["F"+i]={h:follow.student.phoneNumber,r:follow.student.phoneNumber,t:"s",v:follow.student.phoneNumber,w:follow.student.phoneNumber,s:{alignment:{wrapText:!0,vertical:"center"}}}),ws["G"+i]={h:follow.partnerName,r:follow.partnerName,t:"s",v:follow.partnerName,w:follow.partnerName,s:{alignment:{wrapText:!0,vertical:"center"}}},""==$scope.typeName||void 0==$scope.typeName?ws["H"+i]={h:follow.postTitle,r:follow.postTitle,t:"s",v:follow.postTitle,w:follow.postTitle,s:{alignment:{wrapText:!0,vertical:"center"}}}:ws["H"+i]={h:$scope.typeName,r:$scope.typeName,t:"s",v:$scope.typeName,w:$scope.typeName,s:{alignment:{wrapText:!0,vertical:"center"}}},i++,count++)}),wb.SheetNames.push("Registration List"),wb.Sheets["Registration List"]=ws;var wbout=XLSX.write(wb,{bookType:"xlsx",bookSST:!1,type:"binary"});0==count?$scope.alertWarning("Tên cty chưa chính xác!",5e3):(""==$scope.search?saveAs(new Blob([s2ab(wbout)],{type:""}),"Registration List - All.xlsx"):saveAs(new Blob([s2ab(wbout)],{type:""}),"Registration List - "+name+".xlsx"),$scope.alertSuccess("Xuất danh sách thành công!",""))},$scope.createListStudentToSendMessage=function(status){$scope.listStudent=[],angular.forEach($scope.allFollows,function(follow){1==follow.checked&&($scope.partnerName=follow.partnerName,$scope.listStudent.push({studentName:follow.studentName,receiverId:follow.student.id,partnerId:follow.partnerId,postId:follow.postId}))}),$scope.message={},"fail"==status?($scope.message.title="Thông báo không được nhận thực tập",$scope.message.content="Bạn không được nhận "+$scope.partnerName+" làm thực tập."):($scope.message.title="Thông báo được nhận thực tập",$scope.message.content="Chúc mừng bạn có thể chọn "+$scope.partnerName+"để làm thực tập"),console.log($scope.listStudent)},$scope.createFailInterviewMessage=function(){angular.forEach($scope.listStudent,function(message){message.title=$scope.message.title,message.content=$scope.message.content.replace(/(?:\r\n|\r|\n)/g,"<br />"),message.messageType="Normal"}),messageService.createFailInterviewMessage($scope.listStudent).then(function(response){$("#close_send_fail_interview_message").trigger("click"),$scope.alertSuccess("Gửi thông báo thành công!",""),$scope.getAllFollow()},function(error){console.log(error),$scope.alertDanger(error.data.message,""),$("#close_send_fail_interview_message").trigger("click")})},$scope.sendMessage=function(){angular.forEach($scope.listStudent,function(message){message.title=$scope.message.title,message.content=$scope.message.content.replace(/(?:\r\n|\r|\n)/g,"<br />"),message.messageType="PassInterview"}),messageService.createPassInterviewMessage($scope.listStudent).then(function(response){$scope.alertSuccess("Gửi thông báo thành công!","successdelete_edit"),$scope.getAllFollow()},function(error){console.log(error)})},$scope.selectStudent=!1,$scope.selectAllStudent=function(data){$scope.selectStudent=!$scope.selectStudent,void 0!=data?angular.forEach(data,function(student){student.checked=$scope.selectStudent}):""==$scope.search?angular.forEach($scope.allFollows,function(follow){follow.checked=$scope.selectStudent}):angular.forEach($scope.allFollows,function(follow){-1!=follow.partnerName.toLowerCase().indexOf($scope.search.toLowerCase())?follow.checked=$scope.selectStudent:follow.checked=!1})},$scope.createListStudent=function(data){$rootScope.listStudentOfLecturers=[],angular.forEach(data,function(student){1==student.checked&&$rootScope.listStudentOfLecturers.push(student)}),console.log($rootScope.listStudentOfLecturers)},$scope.checkChecked=function(){angular.forEach($scope.allFollows,function(follow){console.log(follow.studentName+follow.checked)})},$scope.getWaitInterviewFollow=function(){studentService.getAllFollow().then(function(response){console.log(response.data),$scope.allFollows=response.data,$scope.totalItems=response.data.lefngth,$scope.currentPage=1,$scope.entryLimit=25,$scope.entryLimit>$scope.totalItems&&($scope.entryLimit=$scope.totalItems),$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit),$scope.$watch("search",function(newVal,oldVal){$scope.filtered=filterFilter($scope.allFollows,newVal),$scope.totalItems=$scope.filtered.length,$scope.noOfPages=Math.ceil($scope.totalItems/$scope.entryLimit),$scope.currentPage=1},!0)},function(error){console.log(error)})},$scope.getStudentByStudentCode=function(){$scope.search={},studentService.getStudentByStudentCode($scope.search).then(function(response){$scope.allStudents=response.data},function(error){console.log(error),$scope.alertWarning("Không tìm có kết quả!","")})},$scope.deleteStudent=function(studentId){$("#close_modal_delete_student").trigger("click"),studentService.deleteStudent(studentId).then(function(){$scope.alertSuccess("Xóa sinh viên thành công!",""),$scope.getAllStudent($scope.page)},function(error){console.log(error),$scope.alertDanger(error.data.message,"")})},$scope.confirmDelete=function(id,name,internId){console.log(id),$scope.confirmDeleteId=id,$scope.confirmDeleteInternId=internId,$scope.confirmDeleteName=name},$scope.getAllStudent=function(page){$scope.page=page,studentService.getAllStudent(page-1,20).then(function(response){console.log(response),$scope.allStudents=response.data.content,$scope.pages=[];for(var page=response.data.totalPages,i=1;i<=page;i++)i==$scope.page?$scope.pages[i]={page:i,class:"active"}:$scope.pages[i]={page:i,class:""},$scope.page==page?$scope.nextPage={class:"disabled",page:page}:$scope.nextPage={class:"",page:parseInt($scope.page)+1},1==$scope.page?$scope.previousPage={class:"disabled",page:1}:$scope.previousPage={class:"",page:$scope.page-1}})},$scope.saveOne=function(){$scope.req={studentCode:$scope.student.studentCode,major:$scope.student.major,studentClass:$scope.student.studentClass,diploma:$scope.student.diploma,grade:$scope.student.grade,graduationYear:$scope.student.graduationYear,gpa:$scope.student.gpa,studentName:$scope.student.studentName},studentService.saveData($scope.req,$scope.student.id).then(function(response){$("#close_modal_edit").trigger("click"),$scope.alertSuccess("Chỉnh sửa thông tin sinh viên thành công!","")},function(error){$scope.alertDanger("Chỉnh sửa thông tin không thành công!","danger"),console.log(error)})},$scope.saveData_=function(){angular.forEach($scope.response,function(arr){1==arr.checked&&studentService.saveData(arr,arr.id).then(function(){arr.checked=!1},function(error){$scope.error=error})})},$,$scope.hideInput=function(data,id){$("#input_"+data+"_"+id).remove()},$scope.selectId=function(v){1!=v.checked?v.checked=!0:1==v.checked&&(v.checked=!1)},$scope.onChange=function(id){angular.forEach($scope.response,function(v){v.id==id&&1!=v.checked&&(v.checked=!0)})},$scope.selectAllId=!1,$scope.selectAll=function(){0==$scope.selectAllId?(angular.forEach($scope.response,function(v){v.checked=!0}),$scope.selectAllId=!0):(angular.forEach($scope.response,function(v){v.checked=!1}),$scope.selectAllId=!1)},$scope.showInput=function(){angular.forEach($scope.response,function(arr){1==arr.checked&&(showInput_(arr.studentCode,arr.id),showInput_(arr.major,arr.id),showInput_(arr.studentClass,arr.id),showInput_(arr.diploma,arr.id),showInput_(arr.grade,arr.id),showInput_(arr.graduationYear,arr.id))})},$scope.edit=function(data){$scope.student=data},$scope.changeStatus=function(userId){studentService.changeStatus(userId).then(function(){1==$scope.student.status?$scope.student.status=!1:$scope.student.status=!0,$scope.alertSuccess("Chuyển trạng thái thành công!","successdelete_edit")},function(error){$scope.alertDanger("Có lỗi xảy ra, hãy reload lại trang và thử lại!","danger")})},$scope.convert=function(){var xlf=document.getElementById("xlf");xlf.addEventListener&&xlf.addEventListener("change",function(e){var i,f,files=e.target.files;for(f=files[i=0];i!=files.length;++i){var reader=new FileReader;f.name,reader.onload=function(e){var data=e.target.result,workbook=XLSX.read(data,{type:"binary"}),first_sheet_name=workbook.SheetNames[0],worksheet=workbook.Sheets[first_sheet_name];$rootScope.excel=XLSX.utils.sheet_to_json(worksheet),$rootScope.excel},reader.readAsBinaryString(f)}$scope.setExcelTable()},!1)},$scope.setExcelTable=function(){$scope.excelTable=$rootScope.excel,angular.forEach($scope.excelTable,function(student){student.emailvnu=student.emailvnu.replace(/(?:@vnu.edu.vn|@gmail.com)/g,"")})},$scope.alertWarning=function(warning,timeout){$scope.warningMessage=warning,$scope.warning=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.warning=!1,$scope.warningMessage=""})},timeout)},$scope.alertDanger=function(error,danger){$scope.errorMessage=error,"danger"==danger?($scope.danger_edit=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.danger_edit=!1})},6e3)):($scope.danger=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.danger=!1,$scope.errorMessage=""})},6e3))},$scope.alertSuccess=function(string,success){$scope.successMessage=string,"successdelete_edit"==success?($scope.successdelete_edit=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.successdelete_edit=!1})},3e3)):($scope.success=!0,$timeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$scope.success=!1})},3e3))}}])}(),function(){function adminService($log,$http,$q,$rootScope){return{getAllNotification:function(){return $http({url:$rootScope.serverAdd+"/notification/all/admin",method:"GET"})},loginAd:function(data){return $http({url:$rootScope.serverAdd+"/admin/login",method:"POST",data:data})},logout:function(){return $http({url:$rootScope.serverAdd+"/logout",method:"GET"})},getAllUser:getAllUser}}angular.module("services").factory("adminService",adminService),adminService.$inject=["$log","$http","$q","$rootScope"]}(),angular.module("services").factory("httpRequestInterceptor",function($rootScope,$q,$timeout){return{request:function(requestConfig){return $rootScope.showToaster=!0,sessionStorage["Admin-Data"]&&(requestConfig.headers["auth-token"]=sessionStorage["Admin-Data"]),requestConfig.headers["Content-Type"]="application/json",requestConfig},response:function(response){return response},responseError:function(response){return $q.reject(response)}}}),angular.module("services").config(function($httpProvider){$httpProvider.interceptors.push("httpRequestInterceptor")}),function(){function internService($log,$http,$q,$rootScope){return{showAllIntern:function(){return $http({url:$rootScope.serverAdd+"/intern",method:"GET"})},showIntern:function(internId){return $http({url:$rootScope.serverAdd+"/intern/"+internId,method:"GET"})},createIntern:function(data){return $http({url:$rootScope.serverAdd+"/intern/create",method:"POST",data:data})},getPartner:function(){return $http({url:$rootScope.serverAdd+"/partner",method:"GET"})},editIntern:function(intern){return $http({url:$rootScope.serverAdd+"/intern/"+intern.id,method:"PUT",data:intern})},del:function(internId,studentId){return $http({url:$rootScope.serverAdd+"/intern/"+internId+"/"+studentId,method:"DELETE"})},deleteIntern:function(internId){return $http({url:$rootScope.serverAdd+"/intern/"+internId,method:"DELETE"})},showAllInternOfPartner:function(partnerId){return $http({url:$rootScope.serverAdd+"/partner/"+partnerId+"/internship",method:"GET"})},showAllCommentOfOnePartner:function(partnerId){return $http({url:$rootScope.serverAdd+"/showAllCommentOfOnePartner/"+partnerId,method:"GET"})},changeFilterValue:function(data,commentId){return $http({url:$rootScope.serverAdd+"/changeFilterValue/"+commentId,method:"PUT",data:data})},getAllInternshipTerm:function(){return $http({url:$rootScope.serverAdd+"/internshipTerm",method:"GET"})},createInternshipTerm:function(data){return $http({url:$rootScope.serverAdd+"/internshipTerm/create",method:"POST",data:data})},loadPostOfInternshipTerm:function(internshipTermId){return $http({url:$rootScope.serverAdd+"/post/internshipTerm/"+internshipTermId,method:"GET"})},deleteInternshipTerm:function(internshipTermId){return $http({url:$rootScope.serverAdd+"/internshipTerm/"+internshipTermId+"/delete",method:"DELETE"})},getAllInternshipByInternshipTerm:function(internshipTermId){return $http({url:$rootScope.serverAdd+"/intern/internshipTerm/"+internshipTermId,method:"GET"})},addLecturers:function(lecturersId,internId){return $http({url:$rootScope.serverAdd+"/internship/add/lecturers/"+lecturersId+"/intern/"+internId,method:"POST"})},getInternOfLecturers:function(lecturersId){return $http({url:$rootScope.serverAdd+"/lecturers/"+lecturersId+"/student",method:"GET"})},getNameAndIdOfPartners:function(val){return $http({url:$rootScope.serverAdd+"/partner/nameAndId/user/"+val,method:"GET"})},getNameAndIdOfLecturers:function(){return $http({url:$rootScope.serverAdd+"/lecturers/nameAndId",method:"GET"})},editInternshipTerm:function(data){return $http({url:$rootScope.serverAdd+"/internshipTerm/edit",method:"PUT",data:data})},getAllStudentNoLecturers:function(){return $http({url:$rootScope.serverAdd+"/student/no/lectutrers",method:"GET"})},addLecturersStudent:function(data,lecturersId){return $http({url:$rootScope.serverAdd+"/student/add/lecturers/"+lecturersId,method:"POST",data:data})},getAllStudentByInternshipTerm:function(internshipTermId){return $http({url:$rootScope.serverAdd+"/student/internshipTerm/"+internshipTermId,method:"GET"})},getAllStudentNoLecturersLastInternshipTerm:function(){return $http({url:$rootScope.serverAdd+"/student/internshipTerm/no/lecturers",method:"GET"})}}}angular.module("services").factory("internService",internService),internService.$inject=["$log","$http","$q","$rootScope"]}(),function(){function lecturersService($log,$http,$q,$rootScope){return{getAllLecturers:function(){return $http({url:$rootScope.serverAdd+"/lecturers",method:"GET"})},createLecturers:function(data){return $http({url:$rootScope.serverAdd+"/createAccount",method:"POST",data:data})},getAllFaculty:function(){return $http({url:$rootScope.serverAdd+"/faculty",method:"GET"})},createFaculty:function(data){return $http({url:$rootScope.serverAdd+"/faculty/create",method:"POST",data:data})},deleteLecturers:function(lecturersId){return $http({url:$rootScope.serverAdd+"/lecturers/delete/"+lecturersId,method:"DELETE"})},createLecturersFromExcel:function(data){return $http({url:$rootScope.serverAdd+"/createLecturers",method:"POST",data:data})},getAllStudentClass:function(){return $http({url:$rootScope.serverAdd+"/studentClass",method:"GET"})},createStudentClass:function(data){return $http({url:$rootScope.serverAdd+"/studentClass/create",method:"POST",data:data})},deleteStudentClass:function(studentClassId){return $http({url:$rootScope.serverAdd+"/studentClass/"+studentClassId+"/delete",method:"DELETE"})},editStudentCLass:function(data){return $http({url:$rootScope.serverAdd+"/studentClass/edit",method:"POST",data:data})},editLecturers:function(data){return $http({url:$rootScope.serverAdd+"/lecturers/info/edit",method:"PUT",data:data})}}}angular.module("services").factory("lecturersService",lecturersService),lecturersService.$inject=["$log","$http","$q","$rootScope"]}(),function(){function loginAdService($log,$http,$q,$rootScope){return{loginAd:function(data){return $http({url:$rootScope.serverAdd+"/admin/login",method:"POST",data:data})},logout:function(){return $http({url:$rootScope.serverAdd+"/logout",method:"GET"})}}}angular.module("services").factory("loginAdService",loginAdService),loginAdService.$inject=["$log","$http","$q","$rootScope"]}(),function(){function messageService($log,$http,$q,$rootScope){return{createPassInterviewMessage:function(data){return $http({url:$rootScope.serverAdd+"/message/passInterview/create",method:"POST",data:data})},getNewMessage:function(){return $http({url:$rootScope.serverAdd+"/message/new",method:"GET"})},getAllMessage:function(page,size,lastUpdated){return void 0==lastUpdated&&(lastUpdated=(new Date).getTime()),$http({url:$rootScope.serverAdd+"/message?&lastUpdated="+lastUpdated+"&page="+page+"&size="+size,method:"GET"})},createMessage:function(data){return $http({url:$rootScope.serverAdd+"/message/create",method:"POST",data:data})},getNotificationMessage:function(){return $http({url:$rootScope.serverAdd+"/message/notification",method:"GET"})},createNotificationMessage:function(data){return $http({url:$rootScope.serverAdd+"/message/notification/create",method:"POST",data:data})},deleteNotificationMessage:function(messageId){return $http({url:$rootScope.serverAdd+"/message/notification/delete/"+messageId,method:"DELETE"})},createFailInterviewMessage:function(data){return $http({url:$rootScope.serverAdd+"/message/failInterview/create",method:"POST",data:data})},getParentMessage:function(messageId){return $http({url:$rootScope.serverAdd+"/message/parent/"+messageId,method:"GET"})},markMessageAsSeen:function(messageId){return $http({url:$rootScope.serverAdd+"/message/"+messageId+"/seen",method:"PUT"})},getOneMessage:function(messageId){return $http({url:$rootScope.serverAdd+"/message/messageId/"+messageId,method:"GET"})}}}angular.module("services").factory("messageService",messageService),messageService.$inject=["$log","$http","$q","$rootScope"]}(),function(){function notificationService($log,$http,$q,$rootScope){return{getAllNotification:function(){return $http({url:$rootScope.serverAdd+"/notification/all/admin",method:"GET"})}}}angular.module("services").factory("notificationService",notificationService),notificationService.$inject=["$log","$http","$q","$rootScope"]}(),function(){function partnerService($log,$http,$q,$rootScope){return{loadAllPartner:function(){return $http({url:$rootScope.serverAdd+"/partner",method:"GET"})},createPartner:function(data){return $http({url:$rootScope.serverAdd+"/createAccount",method:"POST",data:data})},editPartner:function(partnerId,data){return $http({url:$rootScope.serverAdd+"/partnerInfo/"+partnerId,method:"PUT",data:data})},loadPartnerContact:function(partnerId){return $http({url:$rootScope.serverAdd+"/partner/"+partnerId+"/partnerContact",method:"GET"})},loadAllPartnerPost:function(partnerId){return $http({url:$rootScope.serverAdd+"/partner/"+partnerId+"/post",method:"GET"})},loadPost:function(postId){return $http({url:$rootScope.serverAdd+"/post/"+postId,method:"GET"})},getFollowOfPost:function(postId){return $http({url:$rootScope.serverAdd+"/post/"+postId+"/follow",method:"GET"})},changePostStatus:function(postId){return $http({url:$rootScope.serverAdd+"/post/"+postId+"/status",method:"PUT"})},loadPartner:function(partnerInfoId){return $http({url:$rootScope.serverAdd+"/partnerInfo/"+partnerInfoId,method:"GET"})},loadAllPost:function(page,size,postType){return $http({url:$rootScope.serverAdd+"/post",method:"GET"})},createPost:function(partnerId,data){return $http({url:$rootScope.serverAdd+"/partner/"+partnerId+"/post",method:"POST",data:data})},editPost:function(postId,data){return $http({url:$rootScope.serverAdd+"/post/"+postId,method:"PUT",data:data})},deletePost:function(postId){return $http({url:$rootScope.serverAdd+"/post/"+postId,method:"DELETE"})},loadLatestPost:function(page,size,postType){return $http({url:$rootScope.serverAdd+"/post/postType/"+postType+"?page="+page+"&size="+size,method:"GET"})},loadAllPostByInternshipTerm:function(internshipTermId){return $http({url:$rootScope.serverAdd+"/post/internshipTerm/"+internshipTermId,method:"GET"})},getAllFollows:function(){return $http({url:$rootScope.serverAdd+"/follows",method:"GET"})},deletePartner:function(partnerId){return $http({url:$rootScope.serverAdd+"/partner/delete/"+partnerId,method:"DELETE"})},getPartnerNameAndId:function(type){return $http({url:$rootScope.serverAdd+"/partner/nameAndId/user/"+type,method:"GET"})},createPartnerContact:function(partnerId,data){return $http({url:$rootScope.serverAdd+"/partner/"+partnerId+"/partnerContact",method:"POST",data:data})},deletePartnerContact:function(partnerContactId){return $http({url:$rootScope.serverAdd+"/partnerContact/"+partnerContactId,method:"DELETE"})},getOtherPartner:function(){return $http({url:$rootScope.serverAdd+"/partner/other",method:"GET"})},getFitPartner:function(){return $http({url:$rootScope.serverAdd+"/partner/fit",method:"GET"})},editPartnerContact:function(partnerContactId,data){return $http({url:$rootScope.serverAdd+"/partnerContact/"+partnerContactId,method:"PUT",data:data})},getAllWaitpartner:function(){return $http({url:$rootScope.serverAdd+"/partner/wait",method:"GET"})},acceptPartner:function(data){return $http({url:$rootScope.serverAdd+"/checkPartner",method:"POST",data:data})}}}angular.module("services").factory("partnerService",partnerService),partnerService.$inject=["$log","$http","$q","$rootScope"]}(),function(){function studentService($log,$http,$q,$rootScope){return{saveData:function(data,infoBySchoolId){return $http({url:$rootScope.serverAdd+"/infoBySchool/"+infoBySchoolId,method:"PUT",data:data})},infoBySchool:function(){return $http({url:$rootScope.serverAdd+"/infoBySchool",method:"GET"})},loadAllStudent:function(){return $http({url:$rootScope.serverAdd+"/student",method:"GET"})},del:function(infoBySchoolId){return $http({url:$rootScope.serverAdd+"/infoBySchool/"+infoBySchoolId,method:"DELETE"})},changeStatus:function(userId){return $http({url:$rootScope.serverAdd+"/user/"+userId+"/status",method:"PUT"})},createStudent:function(data){return $http({url:$rootScope.serverAdd+"/createStudent",method:"POST",data:data})},getAllStudent:function(page,size){return $http({url:$rootScope.serverAdd+"/student/all?page="+page+"&size="+size,method:"GET"})},deleteStudent:function(studentId){return $http({url:$rootScope.serverAdd+"/student/delete/"+studentId,method:"DELETE"})},getStudentByStudentCode:function(studentCode){return $http({url:$rootScope.serverAdd+"/student/studentCode",method:"POST",data:studentCode})},getUserNameAndEmailVnu:function(startId){return $http({url:$rootScope.serverAdd+"/getUserNameAndEmailVnu/"+startId,method:"GET"})},getWaitInterviewFollow:function(){return $http({url:$rootScope.serverAdd+"/follow/waitInterview",method:"GET"})},removeLecturers:function(studentId){return $http({url:$rootScope.serverAdd+"/student"+studentId+"/remove/lecturers",method:"POST"})},checkExcelLecturersAssignment:function(data){return $http({url:$rootScope.serverAdd+"/student/check/lecturers/excel",method:"POST",data:data})},LecturersAssignmentExcel:function(data){return $http({url:$rootScope.serverAdd+"/lecturers/assignment/excel",method:"POST",data:data})},getAllStudentClass:function(){return $http({url:$rootScope.serverAdd+"/studentClass",method:"GET"})},getCountStudentNoFollow:function(){return $http({url:$rootScope.serverAdd+"/getCountStudentNoFollow",method:"GET"})},getStudentNoInternshipTerm:function(){return $http({url:$rootScope.serverAdd+"/student/no/internshipTerm",method:"GET"})},addFollow:function(data,postId){return $http({url:$rootScope.serverAdd+"/post/"+postId+"/follownew",method:"POST",data:data})},getAllFollow:function(){return $http({url:$rootScope.serverAdd+"/follows",method:"GET"})},addScore:function(internId,score){return $http({url:$rootScope.serverAdd+"/intern/"+internId+"/addscore",method:"PUT",data:score})}}}angular.module("services").factory("studentService",studentService),studentService.$inject=["$log","$http","$q","$rootScope"]}(),function(){var t,e,n,i,r={}.hasOwnProperty,o=[].slice;t={LF:"\n",NULL:"\0"},n=function(){function n(t,e,n){this.command=t,this.headers=null!=e?e:{},this.body=null!=n?n:""}var e;return n.prototype.toString=function(){var e,i,o,s,u;e=[this.command],(o=!1===this.headers["content-length"])&&delete this.headers["content-length"],u=this.headers;for(i in u)r.call(u,i)&&(s=u[i],e.push(i+":"+s));return this.body&&!o&&e.push("content-length:"+n.sizeOfUTF8(this.body)),e.push(t.LF+this.body),e.join(t.LF)},n.sizeOfUTF8=function(t){return t?encodeURI(t).match(/%..|./g).length:0},e=function(e){var i,r,o,s,u,a,c,f,h,l,p,d,g,b,m,v,y;for(s=e.search(RegExp(""+t.LF+t.LF)),o=(u=e.substring(0,s).split(t.LF)).shift(),a={},d=function(t){return t.replace(/^\s+|\s+$/g,"")},g=0,m=(v=u.reverse()).length;g<m;g++)f=(l=v[g]).indexOf(":"),a[d(l.substring(0,f))]=d(l.substring(f+1));if(i="",p=s+2,a["content-length"])h=parseInt(a["content-length"]),i=(""+e).substring(p,p+h);else for(r=null,c=b=p,y=e.length;(p<=y?b<y:b>y)&&(r=e.charAt(c))!==t.NULL;c=p<=y?++b:--b)i+=r;return new n(o,a,i)},n.unmarshall=function(n){var i;return function(){var r,o,s,u;for(u=[],r=0,o=(s=n.split(RegExp(""+t.NULL+t.LF+"*"))).length;r<o;r++)(null!=(i=s[r])?i.length:void 0)>0&&u.push(e(i));return u}()},n.marshall=function(e,i,r){return new n(e,i,r).toString()+t.NULL},n}(),e=function(){function r(t){this.ws=t,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={}}var e;return r.prototype.debug=function(t){var e;return"undefined"!=typeof window&&null!==window&&null!=(e=window.console)?e.log(t):void 0},e=function(){return Date.now?Date.now():(new Date).valueOf},r.prototype._transmit=function(t,e,i){var r;for(r=n.marshall(t,e,i),"function"==typeof this.debug&&this.debug(">>> "+r);;){if(!(r.length>this.maxWebSocketFrameSize))return this.ws.send(r);this.ws.send(r.substring(0,this.maxWebSocketFrameSize)),r=r.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+r.length)}},r.prototype._setupHeartbeat=function(n){var r,o,s,u,a,c;if((a=n.version)===i.VERSIONS.V1_1||a===i.VERSIONS.V1_2)return c=function(){var t,e,i,r;for(r=[],t=0,e=(i=n["heart-beat"].split(",")).length;t<e;t++)u=i[t],r.push(parseInt(u));return r}(),o=c[0],r=c[1],0!==this.heartbeat.outgoing&&0!==r&&(s=Math.max(this.heartbeat.outgoing,r),"function"==typeof this.debug&&this.debug("send PING every "+s+"ms"),this.pinger=i.setInterval(s,function(e){return function(){return e.ws.send(t.LF),"function"==typeof e.debug?e.debug(">>> PING"):void 0}}(this))),0!==this.heartbeat.incoming&&0!==o?(s=Math.max(this.heartbeat.incoming,o),"function"==typeof this.debug&&this.debug("check PONG every "+s+"ms"),this.ponger=i.setInterval(s,function(t){return function(){var n;if((n=e()-t.serverActivity)>2*s)return"function"==typeof t.debug&&t.debug("did not receive server activity for the last "+n+"ms"),t.ws.close()}}(this))):void 0},r.prototype._parseConnect=function(){var t,e,n,i;switch(t=1<=arguments.length?o.call(arguments,0):[],i={},t.length){case 2:i=t[0],e=t[1];break;case 3:t[1]instanceof Function?(i=t[0],e=t[1],n=t[2]):(i.login=t[0],i.passcode=t[1],e=t[2]);break;case 4:i.login=t[0],i.passcode=t[1],e=t[2],n=t[3];break;default:i.login=t[0],i.passcode=t[1],e=t[2],n=t[3],i.host=t[4]}return[i,e,n]},r.prototype.connect=function(){var r,s,u,a;return r=1<=arguments.length?o.call(arguments,0):[],a=this._parseConnect.apply(this,r),u=a[0],this.connectCallback=a[1],s=a[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(i){return function(r){var o,u,a,c,f,h,l,p,d,g,b,m;if(c="undefined"!=typeof ArrayBuffer&&r.data instanceof ArrayBuffer?(o=new Uint8Array(r.data),"function"==typeof i.debug&&i.debug("--- got data length: "+o.length),function(){var t,e,n;for(n=[],t=0,e=o.length;t<e;t++)u=o[t],n.push(String.fromCharCode(u));return n}().join("")):r.data,i.serverActivity=e(),c!==t.LF){for("function"==typeof i.debug&&i.debug("<<< "+c),m=[],d=0,g=(b=n.unmarshall(c)).length;d<g;d++)switch((f=b[d]).command){case"CONNECTED":"function"==typeof i.debug&&i.debug("connected to server "+f.headers.server),i.connected=!0,i._setupHeartbeat(f.headers),m.push("function"==typeof i.connectCallback?i.connectCallback(f):void 0);break;case"MESSAGE":p=f.headers.subscription,(l=i.subscriptions[p]||i.onreceive)?(a=i,h=f.headers["message-id"],f.ack=function(t){return null==t&&(t={}),a.ack(h,p,t)},f.nack=function(t){return null==t&&(t={}),a.nack(h,p,t)},m.push(l(f))):m.push("function"==typeof i.debug?i.debug("Unhandled received MESSAGE: "+f):void 0);break;case"RECEIPT":m.push("function"==typeof i.onreceipt?i.onreceipt(f):void 0);break;case"ERROR":m.push("function"==typeof s?s(f):void 0);break;default:m.push("function"==typeof i.debug?i.debug("Unhandled frame: "+f):void 0)}return m}"function"==typeof i.debug&&i.debug("<<< PONG")}}(this),this.ws.onclose=function(t){return function(){var e;return e="Whoops! Lost connection to "+t.ws.url,"function"==typeof t.debug&&t.debug(e),t._cleanUp(),"function"==typeof s?s(e):void 0}}(this),this.ws.onopen=function(t){return function(){return"function"==typeof t.debug&&t.debug("Web Socket Opened..."),u["accept-version"]=i.VERSIONS.supportedVersions(),u["heart-beat"]=[t.heartbeat.outgoing,t.heartbeat.incoming].join(","),t._transmit("CONNECT",u)}}(this)},r.prototype.disconnect=function(t,e){return null==e&&(e={}),this._transmit("DISCONNECT",e),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof t?t():void 0},r.prototype._cleanUp=function(){if(this.connected=!1,this.pinger&&i.clearInterval(this.pinger),this.ponger)return i.clearInterval(this.ponger)},r.prototype.send=function(t,e,n){return null==e&&(e={}),null==n&&(n=""),e.destination=t,this._transmit("SEND",e,n)},r.prototype.subscribe=function(t,e,n){var i;return null==n&&(n={}),n.id||(n.id="sub-"+this.counter++),n.destination=t,this.subscriptions[n.id]=e,this._transmit("SUBSCRIBE",n),i=this,{id:n.id,unsubscribe:function(){return i.unsubscribe(n.id)}}},r.prototype.unsubscribe=function(t){return delete this.subscriptions[t],this._transmit("UNSUBSCRIBE",{id:t})},r.prototype.begin=function(t){var e,n;return n=t||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:n}),e=this,{id:n,commit:function(){return e.commit(n)},abort:function(){return e.abort(n)}}},r.prototype.commit=function(t){return this._transmit("COMMIT",{transaction:t})},r.prototype.abort=function(t){return this._transmit("ABORT",{transaction:t})},r.prototype.ack=function(t,e,n){return null==n&&(n={}),n["message-id"]=t,n.subscription=e,this._transmit("ACK",n)},r.prototype.nack=function(t,e,n){return null==n&&(n={}),n["message-id"]=t,n.subscription=e,this._transmit("NACK",n)},r}(),i={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(t,n){var r,o;return null==n&&(n=["v10.stomp","v11.stomp"]),r=i.WebSocketClass||WebSocket,o=new r(t,n),new e(o)},over:function(t){return new e(t)},Frame:n},"undefined"!=typeof exports&&null!==exports&&(exports.Stomp=i),"undefined"!=typeof window&&null!==window?(i.setInterval=function(t,e){return window.setInterval(e,t)},i.clearInterval=function(t){return window.clearInterval(t)},window.Stomp=i):exports||(self.Stomp=i)}.call(this);